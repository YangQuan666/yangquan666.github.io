import{_ as $,o as f,c as V,w as D,a as u,n as v,t as z,T as K,r as U,b as m,F as R,d as B,e as j,f as G,g as O,h as I,i as J,v as W,p as X,j as Y}from"./app.4787d829.js";function H(e){e=e||4;var t=e*e,i=0,a=Array.apply(null,{length:e}).map(function(){return Array.apply(null,{length:e}).map(function(){return 0})});function o(r){return a[r.y][r.x]==0}function n(r,s){return a[r.y][r.x]==a[s.y][s.x]}function l(r,s){var c=o(s),b=a[s.y][s.x]+=a[r.y][r.x];return a[r.y][r.x]=0,c?0:b}function d(){for(var r=Math.floor(Math.random()*t),s={},c=t;c>0;c--){if(s.y=Math.floor(r/e),s.x=r%e,o(s))return s;r++,r==t&&(r=0)}return null}function h(r,s,c){r.x=s,r.y=c}function g(r,s,c){r.x=c,r.y=s}function C(r,s,c){r.x=e-1-s,r.y=c}function T(r,s,c){r.x=c,r.y=e-1-s}function M(r){for(var s=0,c=[],b=[],x={},p={},_=0;_<e;_++)for(var L=e,A=e-2;A>=0;A--)if(r(x,A,_),!o(x)){for(var w=A;w+1<L;){if(r(p,w+1,_),!o(p)){n(x,p)&&(w++,L=w);break}w++}if(A!=w){r(p,w,_);var E=l(x,p);c.push({from:{x:x.x,y:x.y},to:{x:p.x,y:p.y}}),E>0&&(b.push({x:p.x,y:p.y,value:E}),s+=E,i+=E)}}return{moves:c,consolidations:b,scoreInc:s}}return{size:e,board:a,score:function(){return i},turn:function(){var r=[],s=d();if(s!=null){var c=Math.random(),b=c>.8?4:2;s.value=b,a[s.y][s.x]=b,r.push(s)}return r},right:function(){return M(h)},down:function(){return M(g)},left:function(){return M(C)},up:function(){return M(T)},canMove:function(){for(var r={y:0},s={y:0},c={y:1};r.y<e;r.y++,s.y++,c.y++)for(r.x=0,s.x=1,c.x=0;r.x<e;r.x++,s.x++,c.x++)if(o(r)||s.x<e&&n(r,s)||c.y<e&&n(r,c))return!0}}}var q=[1,1,.8,.65,.5,.4,.35,.32],y=[];y[2]="#87E293";y[4]="#87E273";y[8]="#eecf40";y[16]="#ffaa4f";y[64]="#9ebbee";y[32]="#6bcae2";y[128]="white";var S=[];S[2]="white";S[4]="white";S[8]="white";S[16]="white";S[32]="white";S[64]="white";S[128]="#2c3e50";const Q={name:"game2048-chip",props:{chip:{type:Object},sizePx:{type:Number},animationTimeMs:{type:Number}},computed:{style:function(){return{fontSize:this.fontSizePx+"px",backgroundColor:this.backColor,color:this.color,boxShadow:this.boxShadow}},fontSizePx:function(){var e=Math.floor(Math.log(this.chip.value)/Math.log(10)),t=Math.floor(this.sizePx/1.5);return t*(e<8?q[e]:q[7])},backColor:function(){return y[this.chip.value]||y[128]},color:function(){return S[this.chip.value]||S[128]},boxShadow:function(){if(this.chip.value<256){var e=this.sizePx*.1+"px ";return"0 "+e+e+"0 black"}else return"0 0 20px "+(2+Math.min(10,Math.log(this.chip.value)/Math.log(2)-7))+"px white"}},watch:{"chip.value":function(){var e=this.$el;if(e){var t=this.animationTimeMs+"ms";e.style["-webkit-animation"]=e.style.animation="chip-value-changed "+t,e.style.transition="background-color "+t,e.style["-webkit-transition"]="-web-kit-background-color "+t}}},methods:{enter:function(e,t){var i=this;if(this.chip.prevRelPos){var a=this.chip.prevRelPos;e.style["-webkit-transform"]=e.style.transform="translate("+a.left+"px,"+a.top+"px)",requestAnimationFrame(function(){requestAnimationFrame(function(){e.style.transition="transform "+i.animationTimeMs+"ms",e.style["-webkit-transition"]="-webkit-transform "+i.animationTimeMs+"ms",e.style["-webkit-transform"]=e.style.transform=""})})}else e.style["-webkit-animation"]=e.style.animation="chip-appear "+this.animationTimeMs+"ms"}}};function Z(e,t,i,a,o,n){return f(),V(K,{css:!1,onEnter:n.enter},{default:D(()=>[u("div",{class:"chip",style:v(n.style)},z(i.chip.value),5)]),_:1},8,["onEnter"])}const ee=$(Q,[["render",Z]]);function te(e,t){var i=!1;function a(){i||(t(),i=!0)}function o(){i=!1,setTimeout(a,e)}return o(),{finish:a,renew:o}}function ie(e){var t=5,i;function a(n){i=n.touches[0],n.preventDefault()}function o(n){var l=n.changedTouches[0],d=i.clientX-l.clientX,h=i.clientY-l.clientY,g=Math.abs(d),C=Math.abs(h);if(!(g<t&&C<t)){var T=g>C?d>0?"left":"right":h>0?"up":"down";e(T)}}return{attach:function(n){n.addEventListener("touchstart",a,!1),n.addEventListener("touchend",o,!1)},detach:function(n){n.removeEventListener("touchstart",a),n.removeEventListener("touchend",o)}}}var P={};P[37]="left";P[38]="up";P[39]="right";P[40]="down";const ne={name:"game2048",components:{Game2048Chip:ee},props:{size:{type:Number},sizeAimMap:{type:Array,required:!0},listenOwnKeyEventsOnly:{type:Boolean,default:!1},tabIndex:{type:Number,default:1},boardSizePx:{type:Number,default:0},animationTimeMs:{type:Number,default:150},started:{type:Boolean,default:!1}},data:function(){var e=this.sizeAimMap[this.size];return{cells:this.createCells(),boardSizeAutoPx:0,aim:e}},mounted:function(){this.boardSizeAutoPx=this.boardSizePx>0?this.boardSizePx:this.$el.getBoundingClientRect().width},watch:{size:function(){this.cells=this.createCells(),this.aim=this.sizeAimMap[this.size],this.$emit("aim-changed",this.aim)},started:function(e,t){e?this.startGame():this.endGame()}},computed:{boardStyle:function(){return{width:this.boardSizePx>0?this.boardSizePx+"px":"100%",height:this.boardSizePx>0?this.boardSizePx+"px":"100%",borderRadius:7/this.size+"%"}},cellStyle:function(){return{width:this.cellSizePct+"%",height:this.cellSizePct+"%",marginLeft:this.cellMarginPct+"%",marginTop:this.cellMarginPct+"%"}},cellSizePct:function(){return 8*this.cellMarginPct},cellMarginPct:function(){return 100/(9*this.size+1)},cellSizePx:function(){return this.cellSizePct/100*(this.boardSizePx>0?this.boardSizePx:this.boardSizeAutoPx)}},methods:{startGame:function(){this.emptyCells();for(var e=H(this.size),t=Math.max(2,this.size-2);t>0;t--){var i=e.turn();this.addChips(i)}var a=this.createGameMove(e);this.runKeyboardControl(a),this.runTouchControl(a),this.$emit("started",this)},runKeyboardControl:function(e){var t=this.listenOwnKeyEventsOnly?this.$el:document,i=function(a){var o=P[a.keyCode];o!=null&&(a.preventDefault(),e(o))};t.addEventListener("keydown",i),this.$once("ended",function(){t.removeEventListener("keydown",i)})},runTouchControl:function(e){var t=ie(function(a){e(a)}),i=this.$el;t.attach(i),this.$once("ended",function(){t.detach(i)})},createGameMove:function(e){var t=this,i={consolidations:[]},a=[],o=te(t.animationTimeMs,function(){t.consolidateChips(i.consolidations),t.addChips(a)});return function(n){if(o.finish(),i=e[n](),a.length=0,i.moves.length>0){for(var l=Math.max(1,t.size-3);l>0;l--){var d=e.turn();d.push.apply(a,d)}if(i.scoreInc>0){t.$emit("score",{score:e.score(),scoreInc:i.scoreInc});for(var l=0;l<i.consolidations.length;l++)if(i.consolidations[l].value==t.aim){t.$emit("aim-reached");break}}}t.moveChips(i.moves),o.renew(),e.canMove()||setTimeout(function(){t.endGame()},t.animationTimeMs)}},endGame:function(){this.$emit("ended",this)},consolidateChips:function(e){var t=this;e.forEach(function(i){var a=t.getCell(i),o=a.chips;o.splice(0,o.length-1),o[0].value=i.value})},moveChips:function(e){for(var t=0;t<e.length;t++)this.moveChip(e[t].from,e[t].to)},moveChip:function(e,t){var i=this.getCell(e),a=this.getCellEl(e),o=this.getCell(t),n=this.getCellEl(t),l=i.chips.splice(0,1)[0],d=a.getBoundingClientRect(),h=n.getBoundingClientRect();l.prevRelPos={left:d.left-h.left,top:d.top-h.top},o.chips.push(l)},addChips:function(e){e.forEach(this.addChip)},addChip:function(e){this.cells[this.getCellIndex(e)].chips.push({value:e.value})},getCellIndex:function(e){return e.y*this.size+e.x},getCell:function(e){return this.cells[this.getCellIndex(e)]},getCellEl:function(e){return this.$refs.cells[this.getCellIndex(e)]},createCells:function(){return Array.apply(null,{length:this.size*this.size}).map(function(){return{chips:[]}})},emptyCells:function(){this.cells.forEach(function(e){e.chips.splice(0)})}}},ae=["tabindex"];function re(e,t,i,a,o,n){const l=U("game2048-chip");return f(),m("div",{class:"board",tabindex:i.tabIndex,style:v(n.boardStyle)},[(f(!0),m(R,null,B(e.cells,(d,h)=>(f(),m("div",{ref_for:!0,ref:"cells",class:"cell",key:d,style:v(n.cellStyle)},[(f(!0),m(R,null,B(d.chips,(g,C)=>(f(),V(l,{ref_for:!0,ref:"chips",key:g,"animation-time-ms":i.animationTimeMs,chip:g,"size-px":n.cellSizePx},null,8,["animation-time-ms","chip","size-px"]))),128))],4))),128))],12,ae)}const se=$(ne,[["render",re]]);var N=420,F=4;const oe={components:{Game2048:se},el:"#app",data:function(){var e=[];e[3]=256,e[4]=2048,e[5]=4096,e[6]=8192;var t={},i={},a=[],o=0;for(var n in e){var l=e[n];i[n]=0,t[l]={aim:l,obtained:!1},a[o++]=n}return{boardSizePx:N,size:F,sizes:a,sizeAimMap:e,gameStarted:!1,gameEnded:!1,gameAim:e[F],gameAimReached:!1,score:0,scoreInc:"",bestScore:i,awards:t}},created:function(){this.loadState()},mounted:function(){var e=this;requestAnimationFrame(function(){e.fitBoardSizePx(),requestAnimationFrame(function(){e.$el.style.visibility="visible",e.showCollectAllAwards()})})},computed:{gameOverStyle:function(){return{fontSize:this.boardSizePx/6+"px"}},gameContainerStyle:function(){return{width:this.boardSizePx+"px",height:this.boardSizePx+"px"}},mainContainerStyle:function(){return{width:this.boardSizePx+"px"}},gameControlsStyle:function(){return{height:this.boardSizePx*.2+"px"}},scoreContainerStyle:function(){return{height:this.boardSizePx*.2+"px"}},gameAimStyle:function(){var e=this.boardSizePx/50+"px ";return{boxShadow:"0 "+e+e+"black",fontSize:this.boardSizePx/110+"em"}},buttonStyle:function(){return{fontSize:this.boardSizePx/450+"em"}},scoreStyle:function(){return{fontSize:this.boardSizePx/280+"em"}},gameAwardsContainerStyle:function(){return{height:this.boardSizePx*.08+"px"}},gameAwardStyle:function(){return{width:this.boardSizePx/5+"px",fontSize:this.boardSizePx/350+"em"}},gameAwardLikeStyle:function(){return{height:this.boardSizePx/21+"px"}},allAwardsObtained:function(){for(var e in this.awards)if(!this.awards[e].obtained)return!1;return!0}},watch:{size:function(){this.gameEnded=!1}},methods:{fitBoardSizePx:function(){window.innerWidth<N*1.04?this.boardSizePx=window.innerWidth*.96:this.boardSizePx=N},loadState:function(){try{var e=document.cookie;if(e){var t=JSON.parse(e);t&&(t.awards&&(this.awards=t.awards),t.bestScore&&(this.bestScore=t.bestScore))}}catch{}},persistState:function(){try{var e={bestScore:this.bestScore,awards:this.awards};document.cookie=JSON.stringify(e)}catch{}},startGame:function(){this.gameStarted=!0,this.score=0,this.showCollectAllAwards()},onGameStarted:function(){this.gameStarted=!0,this.gameEnded=!1},onGameEnded:function(){this.gameStarted=!1,this.gameEnded=!0,this.gameAimReached=!1,this.persistState()},onGameScore:function(e){var t={score:this.score},i=this;if(TweenLite.to(t,.3,{score:e.score,ease:Power0.easeNone,onUpdate:function(){i.score=Math.floor(t.score)}}),e.score>this.bestScore[this.size]){var a={score:this.bestScore[this.size]};TweenLite.to(a,.3,{score:e.score,ease:Power0.easeNone,onUpdate:function(){Vue.set(i.bestScore,i.size,Math.floor(a.score))}})}this.scoreInc=e.scoreInc+"+",Vue.nextTick(function(){i.scoreInc=""})},onGameAimChanged:function(e){this.gameAim=e},onGameAimReached:function(){this.gameAimReached=!0,this.awards[this.gameAim].obtained=!0,this.persistState();var e=this.getAwardEl(this.gameAim),t=this.$refs.gameAim,i=t.getBoundingClientRect(),a=e.getBoundingClientRect(),o=i.width/a.width,n=i.height/a.height,l=i.left-a.left+i.width/4,d=i.top-a.top+i.height/2,h=e.style;h["-webkit-transform"]=h.transform="translate("+l+"px,"+d+"px) scale("+o+","+n+")",h["-webkit-transition"]=h.transition="",h.zIndex=100,requestAnimationFrame(function(){h["-webkit-transition"]=h.transition="all 2s",h["-webkit-transform"]=h.transform=""})},getAwardEl:function(e){for(var t in this.$refs.awards){var i=this.$refs.awards[t];if(i.award.aim==e)return i.$el}return null},showCollectAllAwards:function(){var e=this.$refs.collectAllAwards.style;e["-webkit-animation"]=e.animation="",requestAnimationFrame(function(){e["-webkit-animation"]=e.animation="collect-all-awards 10s"})}}},k=e=>(X("data-v-601dc33c"),e=e(),Y(),e),le={class:"score"},ce=k(()=>u("div",{class:"label"},"Score",-1)),de={key:0,class:"score-inc"},he={class:"score"},ue=k(()=>u("div",{class:"label"},"Best",-1)),fe={key:0,class:"size-control"},me=["id","value"],ve=["for"],pe={key:0},ye=k(()=>u("div",{class:"overlay half-white appearing07"},null,-1)),Se=k(()=>u("p",null,"Game over!",-1)),ge=[Se],be={key:0,style:{display:"none"},ref:"collectAllAwards",class:"collect-all-awards"},we=k(()=>u("span",null,"Collect all awards!",-1)),xe=[we];function ze(e,t,i,a,o,n){const l=U("game-2048");return f(),m("div",{class:"main-container appearing",style:v(n.mainContainerStyle)},[u("div",{class:"score-container",style:v(n.scoreContainerStyle)},[u("div",{ref:"gameAim",class:j(["game-aim",{"game-aim-reached":e.gameAimReached}]),style:v(n.gameAimStyle)},z(e.gameAim),7),u("div",{class:"scores",style:v(n.scoreStyle)},[u("div",le,[ce,u("div",null,[G(z(e.score)+" ",1),O(K,null,{default:D(()=>[e.scoreInc!=""?(f(),m("span",de,z(e.scoreInc),1)):I("",!0)]),_:1})])]),G("  "),u("div",he,[ue,u("div",null,z(e.bestScore[e.size]),1)])],4)],4),u("div",{class:"game-controls",style:v(n.gameControlsStyle)},[e.gameStarted?I("",!0):(f(),m("div",fe,[G(" Size: "),(f(!0),m(R,null,B(e.sizes,d=>(f(),m(R,null,[J(u("input",{type:"radio",id:"size-radio"+d,value:d,"onUpdate:modelValue":t[0]||(t[0]=h=>e.size=h)},null,8,me),[[W,e.size,void 0,{number:!0}]]),u("label",{for:"size-radio"+d},z(d),9,ve)],64))),256)),G("  ")])),e.gameStarted?(f(),m("button",{onClick:t[2]||(t[2]=d=>e.gameStarted=!1),class:"button",style:v(n.buttonStyle),key:"end"},"End",4)):(f(),m("button",{onClick:t[1]||(t[1]=d=>n.startGame()),class:"button",style:v(n.buttonStyle),key:"start"},"New Game",4))],4),u("div",{class:"game-container",style:v(n.gameContainerStyle)},[e.gameEnded?(f(),m("div",pe,[ye,u("div",{class:"overlay game-over appearing",style:v(n.gameOverStyle)},ge,4)])):I("",!0),O(l,{ref:"game",size:e.size,"size-aim-map":e.sizeAimMap,"listen-own-key-events-only":!1,"tab-index":1,"board-size-px":e.boardSizePx,started:e.gameStarted,onStarted:n.onGameStarted,onEnded:n.onGameEnded,onScore:n.onGameScore,onAimChanged:n.onGameAimChanged,onAimReached:n.onGameAimReached},null,8,["size","size-aim-map","board-size-px","started","onStarted","onEnded","onScore","onAimChanged","onAimReached"])],4),n.allAwardsObtained?I("",!0):(f(),m("div",be,xe,512))],4)}const Ce=$(oe,[["render",ze],["__scopeId","data-v-601dc33c"]]),Pe=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"game/2048.md","lastUpdated":1675086350000}'),_e={name:"game/2048.md"},ke=Object.assign(_e,{setup(e){return(t,i)=>(f(),m("div",null,[O(Ce)]))}});export{Pe as __pageData,ke as default};
