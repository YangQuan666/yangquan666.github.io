import{n as se,r as I,c as T,d as ne,w as re,o as ce,a as ue,b as L,e as N,f as m,t as C,u as b,g as w,h as D,i as Q,F as Z,j as z,T as de,k as S,l as ve,m as ie,v as fe}from"./app.cad8043e.js";const ee=t=>`2048_GAME_${t}`,he=()=>({setItem:(u,i,_)=>{const h=()=>{window.localStorage.setItem(ee(u),JSON.stringify(i))};_?h():se(h)},getItem:u=>{const i=window.localStorage.getItem(ee(u));return i?JSON.parse(i):void 0}});let me=1;const P=()=>me++;var E=(t=>(t[t.UP=1]="UP",t[t.DOWN=2]="DOWN",t[t.LEFT=3]="LEFT",t[t.RIGHT=4]="RIGHT",t))(E||{}),B=(t=>(t[t.NORMAL=1]="NORMAL",t[t.MERGE=2]="MERGE",t[t.NEW=3]="NEW",t))(B||{});const ae=(t,s)=>({id:P(),value:t,state:s}),te=t=>{const s=[];for(let u=0;u<t;u++){const i=[];for(let _=0;_<t;_++)i.push(ae(0,1));s.push(i)}return s},A=(t,s,u,i,_)=>{const h=t[s][u],G=t[i][_];t[s][u]=G,t[i][_]=h},_e=t=>t.map(s=>s.map(u=>({...u,state:1}))),pe=t=>{const s=I(0),u=I(te(t)),i=[],_=T(()=>u.value.some(r=>r.some(n=>n.value===0))),h=T(()=>{if(_.value)return!1;const r=u.value;for(let n=0;n<t;n++)for(let e=1;e<t;e++)if(r[e][n].value===r[e-1][n].value)return!1;for(let n=0;n<t;n++)for(let e=1;e<t;e++)if(r[n][e].value===r[n][e-1].value)return!1;return!0}),G=T(()=>{const r=[],n=u.value;for(let e=0;e<t;e++)for(let f=0;f<t;f++)if(n[e][f].value!==0){const a={...n[e][f],x:f,y:e};r.push(a)}return r}),$=()=>{if(i.length){const r=i.pop();u.value=r.data,s.value=r.score}},M=r=>{let n=!1;i.push({score:s.value,data:u.value});const e=_e(u.value);let f=0;switch(r){case 1:for(let a=0;a<t;a++){let d=-1,l=-1,g=-1;for(let o=0;o<t;o++)e[o][a].value===d?(e[l][a].state=2,e[l][a].value+=d,f+=e[l][a].value,e[o][a].value=0,d=-1,l=-1,n=!0):e[o][a].value!==0&&(l=++g,d=e[o][a].value,l!==o&&(A(e,o,a,l,a),n=!0))}break;case 2:for(let a=0;a<t;a++){let d=-1,l=-1,g=t;for(let o=t-1;o>=0;o--)e[o][a].value===d?(e[l][a].state=2,e[l][a].value+=d,f+=e[l][a].value,e[o][a].value=0,d=-1,l=-1,n=!0):e[o][a].value!==0&&(l=--g,d=e[o][a].value,l!==o&&(A(e,o,a,l,a),n=!0))}break;case 3:for(let a=0;a<t;a++){let d=-1,l=-1,g=-1;for(let o=0;o<t;o++)e[a][o].value===d?(e[a][l].state=2,e[a][l].value+=d,f+=e[a][l].value,e[a][o].value=0,d=-1,l=-1,n=!0):e[a][o].value!==0&&(l=++g,d=e[a][o].value,l!==o&&(A(e,a,o,a,l),n=!0))}break;case 4:for(let a=0;a<t;a++){let d=-1,l=-1,g=t;for(let o=t-1;o>=0;o--)e[a][o].value===d?(e[a][l].state=2,e[a][l].value+=d,f+=e[a][l].value,e[a][o].value=0,d=-1,l=-1,n=!0):e[a][o].value!==0&&(l=--g,d=e[a][o].value,l!==o&&(A(e,a,o,a,l),n=!0))}break}u.value=e,s.value+=f,_.value&&n&&R()},R=()=>{const r=[];for(let a=0;a<t;a++)for(let d=0;d<t;d++)u.value[a][d].value===0&&r.push([a,d]);const n=Math.floor(Math.random()*r.length),[e,f]=r[n];u.value[e][f]=ae(Math.random()<.9?2:4,3)};return{gridData:u,cells:G,score:s,isEnd:h,move:M,undo:$,init:r=>{r&&(t=r),s.value=0,i.length=0,u.value=te(t)},start:()=>{R(),R()}}},ge={class:"game"},Ee={class:"grid"},we={class:"grid-header"},ye={class:"controls"},xe=m("h3",null,"2048",-1),be=m("p",{class:"label"},C("SCORE"),-1),Ie={class:"value"},ke=m("p",{class:"label"},"BEST",-1),Le={class:"value"},Ne={class:"row"},Te={class:"dialog"},Ge=m("p",{class:"text"},"GAME OVER",-1),Me=[Ge],Re=ne({__name:"Grid",setup(t){const s=I(4),{cells:u,score:i,isEnd:_,move:h,undo:G,init:$,start:M}=pe(s.value),{setItem:R,getItem:K}=he(),O=T(()=>`size${s.value}_best`),r=I(K(O.value)??0),n=I({id:P(),value:0});re(i,(c,v)=>{n.value.id=P(),n.value.value=c-v,c>r.value&&(r.value=c,R(O.value,r.value))});const e=8,f=I(0),a=T(()=>(f.value-(s.value+1)*e)/s.value),d=T(()=>`
    display: grid;
    grid-template-columns: repeat(${s.value}, 1fr);
    grid-template-rows: repeat(${s.value}, 1fr);
    gap: ${e}px;
    padding: ${e}px;
  `),l=c=>{const v=a.value,{x:y,y:x}=c,k=v*x+e*(x+1),q=v*y+e*(y+1);return`
    width: ${v}px;
    height: ${v}px;
    top: ${k}px;
    left: ${q}px;
    font-size: ${Math.round(v/2.5)}px;
  `},g=()=>{console.log("d"),r.value=K(O.value)??0,$(s.value),M()},o=I();let U=0,W=0,F=!1,V;const H=c=>{U=c.changedTouches[0].clientX,W=c.changedTouches[0].clientY},X=c=>{c.preventDefault()},Y=c=>{const v=c.changedTouches[0].clientX,y=c.changedTouches[0].clientY,x=Math.abs(v-U),k=Math.abs(y-W);Math.max(x,k)<=10||(x>k?v>U?h(E.RIGHT):h(E.LEFT):y>W?h(E.DOWN):h(E.UP))},J=c=>{if(F)return;F=!0;const v=c.altKey||c.ctrlKey||c.metaKey||c.shiftKey;if(!(_.value||v))switch(c.code){case"ArrowUp":h(E.UP);break;case"ArrowDown":h(E.DOWN);break;case"ArrowLeft":h(E.LEFT);break;case"ArrowRight":h(E.RIGHT);break}},j=()=>{F=!1};ce(()=>{var c;if(document.addEventListener("keydown",J,!1),document.addEventListener("keyup",j,!1),o.value){const v=o.value;v.addEventListener("touchstart",H,!1),v.addEventListener("touchmove",X,!1),v.addEventListener("touchend",Y,!1),V=new ResizeObserver(()=>{f.value=v.clientWidth}),V.observe(v),(c=o.value)==null||c.scrollIntoView({behavior:"smooth"})}}),ue(()=>{if(document.removeEventListener("keydown",J,!1),document.removeEventListener("keyup",j,!1),o.value){const c=o.value;c.removeEventListener("touchstart",H,!1),c.removeEventListener("touchmove",X,!1),c.removeEventListener("touchend",Y,!1),V.disconnect()}});const oe=()=>{$(),M()};return M(),(c,v)=>{const y=S("q-icon"),x=S("q-select"),k=S("q-space"),q=S("q-btn"),le=S("q-btn-group");return L(),N("div",ge,[m("div",Ee,[m("header",we,[m("div",ye,[xe,m("div",null,[be,m("p",Ie,C(b(i)),1)]),m("div",null,[ke,m("p",Le,C(r.value),1)])]),m("div",Ne,[w(x,{modelValue:s.value,"onUpdate:modelValue":[v[0]||(v[0]=p=>s.value=p),g],options:[3,4,5,6],behavior:"menu"},{prepend:D(()=>[w(y,{name:"lens_blur"})]),_:1},8,["modelValue"]),w(k),w(le,null,{default:D(()=>[w(q,{icon:"refresh",onClick:oe}),w(q,{icon:"undo",onClick:b(G)},null,8,["onClick"])]),_:1})])]),m("main",{class:"grid-main",ref_key:"gridRef",ref:o,style:Q(b(d))},[(L(!0),N(Z,null,z(s.value*s.value,p=>(L(),N("div",{class:"cell-placeholder",key:p}))),128)),(L(!0),N(Z,null,z(b(u),p=>(L(),N("div",{class:ve(["cell",{[`cell-${p.value}`]:!0,"cell-merge":p.state===b(B).MERGE,"cell-new":p.state===b(B).NEW}]),key:p.id,style:Q(l(p))},C(p.value),7))),128)),w(de,{name:"fade"},{default:D(()=>[ie(m("div",Te,Me,512),[[fe,b(_)]])]),_:1})],4)])])}}});const Se={class:"game"},qe=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"game/2048.md","lastUpdated":1676103940000}'),$e={name:"game/2048.md"},Ae=Object.assign($e,{setup(t){return(s,u)=>(L(),N("div",null,[m("div",Se,[w(Re)])]))}});export{qe as __pageData,Ae as default};
