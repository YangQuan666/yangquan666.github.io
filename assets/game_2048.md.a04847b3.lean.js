import{n as ne,r as N,c as T,d as re,w as ce,o as ue,a as de,b as I,e as k,f as _,t as S,u as b,g as Q,v as Z,h as L,i as D,j as z,F as ee,k as te,T as ve,l as q,m as ie}from"./app.a162de7e.js";const ae=t=>`2048_GAME_${t}`,fe=()=>({setItem:(u,i,m)=>{const h=()=>{window.localStorage.setItem(ae(u),JSON.stringify(i))};m?h():ne(h)},getItem:u=>{const i=window.localStorage.getItem(ae(u));return i?JSON.parse(i):void 0}});let he=1;const P=()=>he++;var E=(t=>(t[t.UP=1]="UP",t[t.DOWN=2]="DOWN",t[t.LEFT=3]="LEFT",t[t.RIGHT=4]="RIGHT",t))(E||{}),B=(t=>(t[t.NORMAL=1]="NORMAL",t[t.MERGE=2]="MERGE",t[t.NEW=3]="NEW",t))(B||{});const se=(t,n)=>({id:P(),value:t,state:n}),oe=t=>{const n=[];for(let u=0;u<t;u++){const i=[];for(let m=0;m<t;m++)i.push(se(0,1));n.push(i)}return n},A=(t,n,u,i,m)=>{const h=t[n][u],G=t[i][m];t[n][u]=G,t[i][m]=h},_e=t=>t.map(n=>n.map(u=>({...u,state:1}))),me=t=>{const n=N(0),u=N(oe(t)),i=[],m=T(()=>u.value.some(r=>r.some(l=>l.value===0))),h=T(()=>{if(m.value)return!1;const r=u.value;for(let l=0;l<t;l++)for(let e=1;e<t;e++)if(r[e][l].value===r[e-1][l].value)return!1;for(let l=0;l<t;l++)for(let e=1;e<t;e++)if(r[l][e].value===r[l][e-1].value)return!1;return!0}),G=T(()=>{const r=[],l=u.value;for(let e=0;e<t;e++)for(let f=0;f<t;f++)if(l[e][f].value!==0){const a={...l[e][f],x:f,y:e};r.push(a)}return r}),$=()=>{if(i.length){const r=i.pop();u.value=r.data,n.value=r.score}},M=r=>{let l=!1;i.push({score:n.value,data:u.value});const e=_e(u.value);let f=0;switch(r){case 1:for(let a=0;a<t;a++){let d=-1,s=-1,g=-1;for(let o=0;o<t;o++)e[o][a].value===d?(e[s][a].state=2,e[s][a].value+=d,f+=e[s][a].value,e[o][a].value=0,d=-1,s=-1,l=!0):e[o][a].value!==0&&(s=++g,d=e[o][a].value,s!==o&&(A(e,o,a,s,a),l=!0))}break;case 2:for(let a=0;a<t;a++){let d=-1,s=-1,g=t;for(let o=t-1;o>=0;o--)e[o][a].value===d?(e[s][a].state=2,e[s][a].value+=d,f+=e[s][a].value,e[o][a].value=0,d=-1,s=-1,l=!0):e[o][a].value!==0&&(s=--g,d=e[o][a].value,s!==o&&(A(e,o,a,s,a),l=!0))}break;case 3:for(let a=0;a<t;a++){let d=-1,s=-1,g=-1;for(let o=0;o<t;o++)e[a][o].value===d?(e[a][s].state=2,e[a][s].value+=d,f+=e[a][s].value,e[a][o].value=0,d=-1,s=-1,l=!0):e[a][o].value!==0&&(s=++g,d=e[a][o].value,s!==o&&(A(e,a,o,a,s),l=!0))}break;case 4:for(let a=0;a<t;a++){let d=-1,s=-1,g=t;for(let o=t-1;o>=0;o--)e[a][o].value===d?(e[a][s].state=2,e[a][s].value+=d,f+=e[a][s].value,e[a][o].value=0,d=-1,s=-1,l=!0):e[a][o].value!==0&&(s=--g,d=e[a][o].value,s!==o&&(A(e,a,o,a,s),l=!0))}break}u.value=e,n.value+=f,m.value&&l&&R()},R=()=>{const r=[];for(let a=0;a<t;a++)for(let d=0;d<t;d++)u.value[a][d].value===0&&r.push([a,d]);const l=Math.floor(Math.random()*r.length),[e,f]=r[l];u.value[e][f]=se(Math.random()<.9?2:4,3)};return{gridData:u,cells:G,score:n,isEnd:h,move:M,undo:$,init:r=>{r&&(t=r),n.value=0,i.length=0,u.value=oe(t)},start:()=>{R(),R()}}},pe={class:"game"},ge={class:"grid"},Ee={class:"grid-header"},we={class:"controls"},ye=_("h3",{class:"title"},"2048",-1),xe={class:"score score-now"},be=_("p",{class:"label"},S("SCORE"),-1),Ie={class:"value"},ke={class:"score"},Le=_("p",{class:"label"},"BEST",-1),Ne={class:"value"},Te={class:"controls"},Ge={class:"dialog"},Me=_("p",{class:"text"},"GAME OVER",-1),Re=[Me],Se=re({__name:"Grid",setup(t){const n=N(4),{cells:u,score:i,isEnd:m,move:h,undo:G,init:$,start:M}=me(n.value),{setItem:R,getItem:C}=fe(),O=T(()=>`size${n.value}_best`),r=N(C(O.value)??0),l=N({id:P(),value:0});ce(i,(c,v)=>{l.value.id=P(),l.value.value=c-v,c>r.value&&(r.value=c,R(O.value,r.value))});const e=8,f=N(0),a=T(()=>(f.value-(n.value+1)*e)/n.value),d=T(()=>`
    display: grid;
    grid-template-columns: repeat(${n.value}, 1fr);
    grid-template-rows: repeat(${n.value}, 1fr);
    gap: ${e}px;
    padding: ${e}px;
  `),s=c=>{const v=a.value,{x:w,y}=c,x=v*y+e*(y+1),V=v*w+e*(w+1);return`
    width: ${v}px;
    height: ${v}px;
    top: ${x}px;
    left: ${V}px;
    font-size: ${Math.round(v/2.5)}px;
  `},g=()=>{console.log("d"),r.value=C(O.value)??0,$(n.value),M()},o=N();let K=0,U=0,W=!1,F;const H=c=>{K=c.changedTouches[0].clientX,U=c.changedTouches[0].clientY},X=c=>{c.preventDefault()},Y=c=>{const v=c.changedTouches[0].clientX,w=c.changedTouches[0].clientY,y=Math.abs(v-K),x=Math.abs(w-U);Math.max(y,x)<=10||(y>x?v>K?h(E.RIGHT):h(E.LEFT):w>U?h(E.DOWN):h(E.UP))},J=c=>{if(W)return;W=!0;const v=c.altKey||c.ctrlKey||c.metaKey||c.shiftKey;if(!(m.value||v))switch(c.code){case"ArrowUp":h(E.UP);break;case"ArrowDown":h(E.DOWN);break;case"ArrowLeft":h(E.LEFT);break;case"ArrowRight":h(E.RIGHT);break}},j=()=>{W=!1};ue(()=>{var c;if(document.addEventListener("keydown",J,!1),document.addEventListener("keyup",j,!1),o.value){const v=o.value;v.addEventListener("touchstart",H,!1),v.addEventListener("touchmove",X,!1),v.addEventListener("touchend",Y,!1),F=new ResizeObserver(()=>{f.value=v.clientWidth}),F.observe(v),(c=o.value)==null||c.scrollIntoView({behavior:"smooth"})}}),de(()=>{if(document.removeEventListener("keydown",J,!1),document.removeEventListener("keyup",j,!1),o.value){const c=o.value;c.removeEventListener("touchstart",H,!1),c.removeEventListener("touchmove",X,!1),c.removeEventListener("touchend",Y,!1),F.disconnect()}});const le=()=>{$(),M()};return M(),(c,v)=>{const w=q("q-icon"),y=q("q-select"),x=q("q-btn"),V=q("q-btn-group");return I(),k("div",pe,[_("div",ge,[_("header",Ee,[_("div",we,[ye,_("div",xe,[be,_("p",Ie,S(b(i)),1),Q((I(),k("span",{class:"score-increment",key:l.value.id}," +"+S(l.value.value),1)),[[Z,l.value.value>0]])]),_("div",ke,[Le,_("p",Ne,S(r.value),1)])]),_("div",Te,[L(y,{modelValue:n.value,"onUpdate:modelValue":[v[0]||(v[0]=p=>n.value=p),g],options:[3,4,5,6],behavior:"menu"},{prepend:D(()=>[L(w,{name:"lens_blur"})]),_:1},8,["modelValue"]),L(V,null,{default:D(()=>[L(x,{icon:"refresh",onClick:le}),L(x,{icon:"undo",onClick:b(G)},null,8,["onClick"])]),_:1})])]),_("main",{class:"grid-main",ref_key:"gridRef",ref:o,style:z(b(d))},[(I(!0),k(ee,null,te(n.value*n.value,p=>(I(),k("div",{class:"cell-placeholder",key:p}))),128)),(I(!0),k(ee,null,te(b(u),p=>(I(),k("div",{class:ie(["cell",{[`cell-${p.value}`]:!0,"cell-merge":p.state===b(B).MERGE,"cell-new":p.state===b(B).NEW}]),key:p.id,style:z(s(p))},S(p.value),7))),128)),L(ve,{name:"fade"},{default:D(()=>[Q(_("div",Ge,Re,512),[[Z,b(m)]])]),_:1})],4)])])}}});const $e={class:"game"},Ae=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"game/2048.md","lastUpdated":1675265290000}'),Oe={name:"game/2048.md"},Ce=Object.assign(Oe,{setup(t){return(n,u)=>(I(),k("div",null,[_("div",$e,[L(Se)])]))}});export{Ae as __pageData,Ce as default};
