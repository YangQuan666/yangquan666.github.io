<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>华硕RT-AX56U V2路由器安装clash | YangQuan's blog</title>
    <meta name="description" content="YangQuan666's person blog site">
    <link rel="stylesheet" href="/assets/style.3b488bfa.css">
    <link rel="modulepreload" href="/assets/app.358d9a8e.js">
    <link rel="modulepreload" href="/assets/post_asus-clash.md.88ae35c7.lean.js">
    
    <meta name="viewport" content="user-scalable=no, initial-scale=1, width=device-width">
  <link rel="icon" type="image/svg+xml" href="/logo.svg">
  <meta name="twitter:title" content="华硕RT-AX56U V2路由器安装clash | YangQuan&#39;s blog">
  <meta property="og:title" content="华硕RT-AX56U V2路由器安装clash | YangQuan&#39;s blog">
  </head>
  <body>
    <div id="app"><div class="q-layout q-layout--standard" style="min-height:0px;"><!----><!----><header class="q-header q-layout__section--marginal fixed-top" style=""><div class="q-toolbar row no-wrap items-center"><button class="q-btn q-btn-item non-selectable no-outline q-btn--flat q-btn--round q-btn--actionable q-focusable q-hoverable" style="" tabindex="0" type="button"><span class="q-focus-helper"></span><span class="q-btn__content text-center col items-center q-anchor--skip justify-center row"><i class="q-icon notranslate material-icons" style="" aria-hidden="true" role="img">menu</i></span></button><div class="q-toolbar__title ellipsis col-shrink row items-center no-wrap"><div class="q-avatar" style=""><div class="q-avatar__content row flex-center overflow-hidden" style=""><img src="https://cdn.quasar.dev/logo-v2/svg/logo.svg"></div></div><span class="gt-sm">Yang Quan</span></div><div class="q-space"></div><label class="q-field row no-wrap items-start q-field--standout q-select q-field--auto-height q-select--with-input q-select--without-chips q-select--single q-field--dense" style="width:50%;" for="f_031c862d-eb47-414c-ac61-3ba538fd96d9"><!----><div class="q-field__inner relative-position col self-stretch"><div class="q-field__control relative-position row no-wrap" tabindex="-1"><div class="q-field__prepend q-field__marginal row no-wrap items-center"><i class="q-icon notranslate material-icons" style="" aria-hidden="true" role="presentation">search</i></div><div class="q-field__control-container col relative-position row no-wrap q-anchor--skip"><div class="q-field__native row items-center"><span></span><input class="q-field__input q-placeholder col q-field__input--padding" style="" value type="search" tabindex="0" role="combobox" aria-autocomplete="list" aria-expanded="false" aria-owns="f_031c862d-eb47-414c-ac61-3ba538fd96d9_lb" aria-controls="f_031c862d-eb47-414c-ac61-3ba538fd96d9_lb" id="f_031c862d-eb47-414c-ac61-3ba538fd96d9"></div><!----></div><!----><!----></div><!----></div><!----></label><div class="q-space"></div><!--[--><div class="gt-sm"><!--[--><button class="q-btn q-btn-item non-selectable no-outline q-btn--flat q-btn--rectangle q-btn--actionable q-focusable q-hoverable no-border-radius self-stretch q-btn-dropdown q-btn-dropdown--simple" style="" tabindex="0" type="button" modelvalue="false" split="false" cover="false" persistent="false" noroutedismiss="false" autoclose="false" menuanchor="bottom end" menuself="top end" disablemainbtn="false" disabledropdown="false" noiconanimation="false" aria-expanded="false" aria-haspopup="true"><span class="q-focus-helper"></span><span class="q-btn__content text-center col items-center q-anchor--skip justify-center row no-wrap text-no-wrap"><i class="q-icon notranslate material-icons" style="" aria-hidden="true" role="img">invert_colors</i><i class="q-icon notranslate material-icons q-btn-dropdown__arrow q-btn-dropdown__arrow-container" style="" aria-hidden="true" role="presentation">arrow_drop_down</i><!----></span></button><button class="q-btn q-btn-item non-selectable no-outline q-btn--flat q-btn--rectangle q-btn--actionable q-focusable q-hoverable no-border-radius self-stretch q-btn-dropdown q-btn-dropdown--simple" style="" tabindex="0" type="button" modelvalue="false" split="false" cover="false" persistent="false" noroutedismiss="false" autoclose="false" menuanchor="bottom end" menuself="top end" disablemainbtn="false" disabledropdown="false" noiconanimation="false" aria-expanded="false" aria-haspopup="true"><span class="q-focus-helper"></span><span class="q-btn__content text-center col items-center q-anchor--skip justify-center row no-wrap text-no-wrap"><i class="q-icon notranslate material-icons" style="" aria-hidden="true" role="img">translate</i><i class="q-icon notranslate material-icons q-btn-dropdown__arrow q-btn-dropdown__arrow-container" style="" aria-hidden="true" role="presentation">arrow_drop_down</i><!----></span></button><!--]--></div><div class="lt-sm"><button class="q-btn q-btn-item non-selectable no-outline q-btn--flat q-btn--round q-btn--actionable q-focusable q-hoverable" style="" tabindex="0" type="button"><span class="q-focus-helper"></span><span class="q-btn__content text-center col items-center q-anchor--skip justify-center row"><i class="q-icon notranslate material-icons" style="" aria-hidden="true" role="img">more_vert</i><!----></span></button></div><!--]--></div><div class="q-layout__shadow absolute-full overflow-hidden no-pointer-events"></div><!----></header><div class="q-drawer-container"><div class="fullscreen q-drawer__backdrop hidden" style="background-color:rgba(0,0,0,0);" aria-hidden="true"></div><aside class="q-drawer q-drawer--left q-layout--prevent-focus fixed q-drawer--on-top q-drawer--mobile q-drawer--top-padding" style="width:300px;transform:translateX(-300px);"><div class="q-drawer__content fit scroll"><div class="q-scrollarea fit"><div class="q-scrollarea__container scroll relative-position fit hide-scrollbar"><div class="q-scrollarea__content absolute" style=""><!----><div class="q-img q-img--menu" style="" role="img"><div style="padding-bottom:56.25%;"></div><div class="q-img__content absolute-full q-anchor--skip"><div class="absolute-bottom bg-transparent"><div class="q-avatar q-mb-sm" style="font-size:150px;"><div class="q-avatar__content row flex-center overflow-hidden" style=""><img src="/avatar.png" alt="avatar"></div></div><div class="text-weight-bold">YangQuan</div><div>quark.yeung@icloud.com</div></div></div></div><div class="q-list q-list--padding"><!--[--><div class="q-item q-item-type row no-wrap q-item--clickable q-link cursor-pointer q-focusable q-hoverable" style="" tabindex="0"><div class="q-focus-helper" tabindex="-1"></div><div class="q-item__section column q-item__section--side justify-center q-item__section--avatar"><i class="q-icon notranslate material-icons" style="" aria-hidden="true" role="presentation">home</i></div><div class="q-item__section column q-item__section--main justify-center">Home</div></div><div class="q-item q-item-type row no-wrap q-item--clickable q-link cursor-pointer q-focusable q-hoverable" style="" tabindex="0"><div class="q-focus-helper" tabindex="-1"></div><div class="q-item__section column q-item__section--side justify-center q-item__section--avatar"><i class="q-icon notranslate material-icons" style="" aria-hidden="true" role="presentation">person</i></div><div class="q-item__section column q-item__section--main justify-center">About</div></div><!--]--></div></div><!----></div><!----><div class="q-scrollarea__bar q-scrollarea__bar--v absolute-right q-scrollarea__bar--invisible" style="" aria-hidden="true"></div><div class="q-scrollarea__bar q-scrollarea__bar--h absolute-bottom q-scrollarea__bar--invisible" style="" aria-hidden="true"></div><div class="q-scrollarea__thumb q-scrollarea__thumb--v absolute-right q-scrollarea__thumb--invisible" style="top:0px;height:50px;" aria-hidden="true"></div><div class="q-scrollarea__thumb q-scrollarea__thumb--h absolute-bottom q-scrollarea__thumb--invisible" style="left:0px;width:50px;" aria-hidden="true"></div></div></div></aside></div><div class="q-page-container" style="padding-top:50px;"><div class="q-pa-md q-gutter-sm"><div class="q-breadcrumbs"><div class="flex items-center justify-start q-gutter-sm"><div class="flex items-center"><span class="q-breadcrumbs__el q-link flex inline items-center relative-position q-link--focusable"><i class="q-icon notranslate material-icons q-breadcrumbs__el-icon" style="" aria-hidden="true" role="presentation">home</i></span></div><div class="q-breadcrumbs__separator">/</div><div class="flex items-center"><span class="q-breadcrumbs__el q-link flex inline items-center relative-position q-link--focusable"><i class="q-icon notranslate material-icons q-breadcrumbs__el-icon q-breadcrumbs__el-icon--with-label" style="" aria-hidden="true" role="presentation">widgets</i>Docs</span></div><div class="q-breadcrumbs__separator">/</div><div class="flex items-center"><span class="q-breadcrumbs__el q-link flex inline items-center relative-position q-link--focusable"><i class="q-icon notranslate material-icons q-breadcrumbs__el-icon q-breadcrumbs__el-icon--with-label" style="" aria-hidden="true" role="presentation">navigation</i>Breadcrumbs</span></div><div class="q-breadcrumbs__separator">/</div><div class="flex items-center q-breadcrumbs--last"><span class="q-breadcrumbs__el q-link flex inline items-center relative-position q-link--focusable"><i class="q-icon notranslate material-icons q-breadcrumbs__el-icon q-breadcrumbs__el-icon--with-label" style="" aria-hidden="true" role="presentation">build</i>Build</span></div></div></div></div><main class="q-page  q-layout-padding" style="min-height:calc(100vh - 50px);"><!----><!--[--><div style="position:relative;"><div><h1 id="华硕rt-ax56u-v2路由器安装clash" tabindex="-1">华硕RT-AX56U V2路由器安装clash <a class="header-anchor" href="#华硕rt-ax56u-v2路由器安装clash" aria-hidden="true">#</a></h1><ol><li><p>参考项目：<a href="https://github.com/iloahz/asus-router-stock-firmware-clash" target="_blank" rel="noopener noreferrer">iloahz/asus-router-stock-firmware-clash</a></p></li><li><p>clash地址（armv7）：<a href="https://github.com/Dreamacro/clash" target="_blank" rel="noopener noreferrer">Dreamacro/clash: A rule-based tunnel in Go. (github.com)</a></p></li><li><p>web界面：<a href="https://github.com/haishanh/yacd" target="_blank" rel="noopener noreferrer">haishanh/yacd: Yet Another Clash Dashboard (github.com)</a></p></li></ol><h2 id="开启ssh" tabindex="-1">开启SSH <a class="header-anchor" href="#开启ssh" aria-hidden="true">#</a></h2><ol><li><p>登录路由器后台 &gt; 系统管理 &gt; 系统设置</p></li><li><p>ssh命令登录路由器：<code>ssh {username}@192.168.50.1</code></p></li></ol><h2 id="配置启动和关闭脚本" tabindex="-1">配置启动和关闭脚本 <a class="header-anchor" href="#配置启动和关闭脚本" aria-hidden="true">#</a></h2><ol><li><p><a href="http://start.sh" target="_blank" rel="noopener noreferrer">start.sh</a></p><div class="language-shell"><pre><code><span class="token shebang important">#!/bin/sh</span>

<span class="token function-name function">create_iptables_rules</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token operator">!</span> /usr/sbin/iptables -L -n -t nat <span class="token operator">|</span> <span class="token function">grep</span> -lq CLASH<span class="token punctuation">;</span> <span class="token keyword">then</span>
        /usr/sbin/iptables -t nat -A PREROUTING -p tcp --dport <span class="token number">22</span> -j ACCEPT
        /usr/sbin/iptables -t nat -N CLASH
        /usr/sbin/iptables -t nat -A CLASH -p tcp --dport <span class="token number">7890</span> -j RETURN
        /usr/sbin/iptables -t nat -A CLASH -d <span class="token number">192.168</span>.0.0/16 -j RETURN
        /usr/sbin/iptables -t nat -A CLASH -p tcp -j REDIRECT --to-ports <span class="token number">7892</span>
        /usr/sbin/iptables -t nat -A PREROUTING -j CLASH
        /usr/sbin/iptables -t nat -A PREROUTING -p udp -m udp --dport <span class="token number">53</span> -j DNAT --to-destination <span class="token number">192.168</span>.50.1:1053
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token assign-left variable">clashdir</span><span class="token operator">=</span>/jffs/clash
<span class="token function-name function">start_clash</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">killall</span> clash
    <span class="token function">nohup</span> <span class="token variable">$clashdir</span>/clash -d <span class="token variable">$clashdir</span> -f <span class="token variable">$clashdir</span>/config.yaml <span class="token operator">&gt;</span> nohup.out <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
<span class="token punctuation">}</span>

create_iptables_rules
start_clash
</code></pre></div></li><li><p><a href="http://stop.sh" target="_blank" rel="noopener noreferrer">stop.sh</a></p><div class="language-shell"><pre><code><span class="token shebang important">#!/bin/sh</span>

<span class="token function-name function">clear_iptables_rules</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> /usr/sbin/iptables -L -n -t nat <span class="token operator">|</span> <span class="token function">grep</span> -lq CLASH<span class="token punctuation">;</span> <span class="token keyword">then</span>
    /usr/sbin/iptables -t nat -D PREROUTING -p tcp --dport <span class="token number">22</span> -j ACCEPT
    /usr/sbin/iptables -t nat -D PREROUTING -j CLASH
    /usr/sbin/iptables -t nat -F CLASH
    /usr/sbin/iptables -t nat -X CLASH
    /usr/sbin/iptables -t nat -D PREROUTING -p udp -m udp --dport <span class="token number">53</span> -j DNAT --to-destination <span class="token number">192.168</span>.50.1:1053
  <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token function-name function">stop_clash</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">killall</span> clash
<span class="token punctuation">}</span>

clear_iptables_rules
stop_clash
</code></pre></div></li></ol><h2 id="访问控制界面" tabindex="-1">访问控制界面 <a class="header-anchor" href="#访问控制界面" aria-hidden="true">#</a></h2><ol><li><p>执行<code>sh start.sh</code></p></li><li><p>访问<a href="http://192.168.50.1:9090/ui/#/proxies" target="_blank" rel="noopener noreferrer">192.168.50.1:9090 - yacd</a></p></li></ol></div></div><!----><div class="q-drawer-container"><div class="q-drawer__opener fixed-right" aria-hidden="true"></div><div class="fullscreen q-drawer__backdrop hidden" style="background-color:rgba(0,0,0,0);" aria-hidden="true"></div><aside class="q-drawer q-drawer--right q-drawer--bordered q-layout--prevent-focus fixed q-drawer--on-top q-drawer--mobile q-drawer--top-padding" style="width:300px;transform:translateX(300px);"><div class="q-drawer__content fit scroll"></div></aside></div><!--]--></main></div><footer class="q-footer q-layout__section--marginal absolute-bottom q-footer--bordered bg-grey-8 text-white" style=""><!----><div class="q-toolbar row no-wrap items-center"><div class="q-toolbar__title ellipsis"><div>Footer</div></div></div></footer></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"93e3fc14\",\"post_asus-clash.md\":\"88ae35c7\",\"post_eason-chan.md\":\"63c58df4\",\"post_hik-resume.md\":\"1bc678b6\"}")</script>
    <script type="module" async src="/assets/app.358d9a8e.js"></script>
    
  </body>
</html>