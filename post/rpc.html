<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    
    <title>从零开始写一个RPC框架 | 萨科的魔术盒</title>
    <meta name="description" content="YangQuan的个人博客网站">
    <meta name="generator" content="VitePress v1.0.0-rc.40">
    <link rel="preload stylesheet" href="/assets/style.r6hAgZfK.css" as="style">
    
    <script type="module" src="/assets/app.P3TeRxyG.js"></script>
    <link rel="modulepreload" href="/assets/chunks/framework.YixF1Q1-.js">
    <link rel="modulepreload" href="/assets/chunks/theme.B6cyK4-B.js">
    <link rel="modulepreload" href="/assets/post_rpc.md.-20CjufT.lean.js">
    <meta name="viewport" content="user-scalable=0, initial-scale=1, maximum-scale=1, width=device-width">
    <meta name="google-site-verification" content="RAVRlhHFJKHyrrg75VIxZPLEm6Vy7g846tY7WCmvQmA">
    <link rel="icon" type="image/svg+xml" href="/logo.svg">
    <link rel="me" href="https://mastodon.social/@Kourtsis">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="q-layout q-layout--standard" style="min-height:0px;" tabindex="-1"><!----><!----><header class="q-header q-layout__section--marginal fixed-top" style=""><div class="q-toolbar row no-wrap items-center" role="toolbar" drawer="false"><button class="q-btn q-btn-item non-selectable no-outline q-btn--flat q-btn--round q-btn--actionable q-focusable q-hoverable" style="" tabindex="0" type="button"><span class="q-focus-helper"></span><span class="q-btn__content text-center col items-center q-anchor--skip justify-center row"><i class="q-icon notranslate material-icons" style="" aria-hidden="true" role="img">menu</i></span></button><div class="q-toolbar__title ellipsis col-shrink row items-center no-wrap"><div class="q-avatar" style=""><div class="q-avatar__content row flex-center overflow-hidden" style=""><img src="/logo.svg" alt="logo" class="image-container"></div></div><span class="q-ml-sm">萨科的魔术盒</span></div><div class="q-space"></div><div class="search-field search-closed"><div class="ais-InstantSearch"><!----></div></div><div class="q-space gt-sm"></div><!----></div><!----><div class="q-layout__shadow absolute-full overflow-hidden no-pointer-events"></div><!----></header><div class="q-drawer-container"><div class="fullscreen q-drawer__backdrop hidden" style="background-color:rgba(0,0,0,0);" aria-hidden="true"></div><aside class="q-drawer q-drawer--left q-layout--prevent-focus fixed q-drawer--on-top q-drawer--mobile q-drawer--top-padding" style="width:300px;transform:translateX(-300px);"><div class="q-drawer__content fit scroll"><div class="q-scrollarea fit"><div class="q-scrollarea__container scroll relative-position fit hide-scrollbar"><div class="q-scrollarea__content absolute" style=""><!----><div class="q-img q-img--menu" style="height:300px;" role="img"><div style="padding-bottom:56.25%;"></div><div class="q-img__content absolute-full q-anchor--skip"><div class="absolute-bottom bg-transparent" style="text-align:center;"><div class="q-avatar q-mb-sm" style="font-size:150px;"><div class="q-avatar__content row flex-center overflow-hidden" style=""><img src="/avatar.webp" alt="avatar"></div></div><div class="q-card__section q-card__section--vert">一个爱折腾的程序员 )=￣ω￣=)</div><div class="row"><!--[--><div class="col" style="text-align:center;"><a class="q-btn q-btn-item non-selectable no-outline q-btn--flat q-btn--round q-btn--actionable q-focusable q-hoverable" style="" tabindex="0" href="https://github.com/YangQuan666"><span class="q-focus-helper"></span><span class="q-btn__content text-center col items-center q-anchor--skip justify-center row"><i class="q-icon" style="" aria-hidden="true" role="img"><svg viewBox="0 0 16 16"><path style="" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8"></path></svg></i></span></a></div><div class="col" style="text-align:center;"><a class="q-btn q-btn-item non-selectable no-outline q-btn--flat q-btn--round q-btn--actionable q-focusable q-hoverable" style="" tabindex="0" href="https://discord.gg/J8BVvnsWeB"><span class="q-focus-helper"></span><span class="q-btn__content text-center col items-center q-anchor--skip justify-center row"><i class="q-icon" style="" aria-hidden="true" role="img"><svg viewBox="0 0 16 16"><path style="" d="M13.545 2.907a13.227 13.227 0 0 0-3.257-1.011.05.05 0 0 0-.052.025c-.141.25-.297.577-.406.833a12.19 12.19 0 0 0-3.658 0 8.258 8.258 0 0 0-.412-.833.051.051 0 0 0-.052-.025c-1.125.194-2.22.534-3.257 1.011a.041.041 0 0 0-.021.018C.356 6.024-.213 9.047.066 12.032c.001.014.01.028.021.037a13.276 13.276 0 0 0 3.995 2.02.05.05 0 0 0 .056-.019c.308-.42.582-.863.818-1.329a.05.05 0 0 0-.01-.059.051.051 0 0 0-.018-.011 8.875 8.875 0 0 1-1.248-.595.05.05 0 0 1-.02-.066.051.051 0 0 1 .015-.019c.084-.063.168-.129.248-.195a.05.05 0 0 1 .051-.007c2.619 1.196 5.454 1.196 8.041 0a.052.052 0 0 1 .053.007c.08.066.164.132.248.195a.051.051 0 0 1-.004.085 8.254 8.254 0 0 1-1.249.594.05.05 0 0 0-.03.03.052.052 0 0 0 .003.041c.24.465.515.909.817 1.329a.05.05 0 0 0 .056.019 13.235 13.235 0 0 0 4.001-2.02.049.049 0 0 0 .021-.037c.334-3.451-.559-6.449-2.366-9.106a.034.034 0 0 0-.02-.019Zm-8.198 7.307c-.789 0-1.438-.724-1.438-1.612 0-.889.637-1.613 1.438-1.613.807 0 1.45.73 1.438 1.613 0 .888-.637 1.612-1.438 1.612m5.316 0c-.788 0-1.438-.724-1.438-1.612 0-.889.637-1.613 1.438-1.613.807 0 1.451.73 1.438 1.613 0 .888-.631 1.612-1.438 1.612"></path></svg></i></span></a></div><!--]--></div></div></div></div><!--[--><div class="q-expansion-item q-item-type q-expansion-item--expanded q-expansion-item--standard" padding><div class="q-expansion-item__container relative-position"><div class="q-item q-item-type row no-wrap q-item--clickable q-link cursor-pointer q-focusable q-hoverable" style="" role="button" tabindex="0" aria-expanded="true" aria-label="Collapse &quot;主页&quot;"><div class="q-focus-helper" tabindex="-1"></div><div class="q-item__section column q-item__section--side justify-center q-item__section--avatar"><i class="q-icon notranslate material-icons" style="" aria-hidden="true" role="presentation">home</i></div><div class="q-item__section column q-item__section--main justify-center"><div style="" class="q-item__label">主页</div><!----></div></div><div class="q-expansion-item__content relative-position" style=""><!--[--><!--]--></div></div></div><div class="q-expansion-item q-item-type q-expansion-item--expanded q-expansion-item--standard" padding><div class="q-expansion-item__container relative-position"><div class="q-item q-item-type row no-wrap q-item--clickable q-link cursor-pointer q-focusable q-hoverable" style="" role="button" tabindex="0" aria-expanded="true" aria-label="Collapse &quot;小游戏&quot;"><div class="q-focus-helper" tabindex="-1"></div><div class="q-item__section column q-item__section--side justify-center q-item__section--avatar"><i class="q-icon notranslate material-icons" style="" aria-hidden="true" role="presentation">videogame_asset</i></div><div class="q-item__section column q-item__section--main justify-center"><div style="" class="q-item__label">小游戏</div><!----></div><div class="q-item__section column q-item__section--side justify-center q-focusable relative-position cursor-pointer"><i class="q-icon notranslate material-icons q-expansion-item__toggle-icon q-expansion-item__toggle-icon--rotated" style="" aria-hidden="true" role="presentation">keyboard_arrow_down</i></div></div><div class="q-expansion-item__content relative-position" style=""><!--[--><div class="q-item q-item-type row no-wrap q-item--clickable q-link cursor-pointer q-focusable q-hoverable" style="" role="listitem" tabindex="0"><div class="q-focus-helper" tabindex="-1"></div><div class="q-item__section column q-item__section--side justify-center q-item__section--avatar"></div><div class="q-item__section column q-item__section--main justify-center">Chrome Dinosaur</div><div class="q-item__section column q-item__section--side justify-center q-item__section--avatar"><i class="q-icon notranslate material-icons" style="" aria-hidden="true" role="presentation">smart_toy</i></div></div><div class="q-item q-item-type row no-wrap q-item--clickable q-link cursor-pointer q-focusable q-hoverable" style="" role="listitem" tabindex="0"><div class="q-focus-helper" tabindex="-1"></div><div class="q-item__section column q-item__section--side justify-center q-item__section--avatar"></div><div class="q-item__section column q-item__section--main justify-center">2048</div><div class="q-item__section column q-item__section--side justify-center q-item__section--avatar"><i class="q-icon notranslate material-icons" style="" aria-hidden="true" role="presentation">casino</i></div></div><!--]--></div></div></div><!--]--></div><!----></div><!----><div class="q-scrollarea__bar q-scrollarea__bar--v absolute-right q-scrollarea__bar--invisible" style="" aria-hidden="true"></div><div class="q-scrollarea__bar q-scrollarea__bar--h absolute-bottom q-scrollarea__bar--invisible" style="" aria-hidden="true"></div><div class="q-scrollarea__thumb q-scrollarea__thumb--v absolute-right q-scrollarea__thumb--invisible" style="top:0px;height:0px;" aria-hidden="true"></div><div class="q-scrollarea__thumb q-scrollarea__thumb--h absolute-bottom q-scrollarea__thumb--invisible" style="left:0px;width:0px;" aria-hidden="true"></div></div></div></aside></div><div class="q-page-container" style="padding-top:50px;"><main class="q-page q-layout-padding" style="min-height:calc(100vh - 50px);"><!--[--><div class="q-img q-img--menu" style="height:400px;" role="img" aria-label="background"><div style="padding-bottom:56.25%;"></div><div class="q-img__content absolute-full q-anchor--skip"><h3 class="absolute-full flex flex-center"> Talk is cheap. Show me the code. </h3></div></div><div class="row animate__animated animate__fadeIn"><div class="col-12 col-sm-10 offset-sm-1"><div class="q-card__actions justify-start q-card__actions--horiz row"><i class="q-icon notranslate material-icons" style="" aria-hidden="true" role="presentation">schedule</i> 预计阅读分钟 <div class="q-space"></div><i class="q-icon notranslate material-icons" style="" aria-hidden="true" role="presentation">update</i> 2023-08-07更新 </div><div style="position:relative;" class="markdown-body"><div><h1 id="从零开始写一个rpc框架" tabindex="-1">从零开始写一个RPC框架 <a class="header-anchor" href="#从零开始写一个rpc框架" aria-label="Permalink to &quot;从零开始写一个RPC框架&quot;">​</a></h1><blockquote><p>一直以来都对RPC框架的实现很感兴趣，因此占用了几个下班时间，写出了这篇文章，希望能让读者对RPC框架的原理有个深刻的认识</p><p><strong>说明</strong>：本文所有代码均可在<a href="https://github.com/YangQuan666/demo/tree/rpc" target="_blank" rel="noreferrer">我的github仓库</a>中找到</p></blockquote><p><img src="/post/rpc/rpc.svg" style="max-height:400px;" loading="lazy"></p><h2 id="开始之前" tabindex="-1">开始之前 <a class="header-anchor" href="#开始之前" aria-label="Permalink to &quot;开始之前&quot;">​</a></h2><p>想象一下，如果要自己实现一个远程调用的框架，我们需要哪些轮子呢， 首先对于Java开发人员来说<code>Spring框架</code>是不可避免的； 其次RPC框架涉及到服务的发现和治理，因此我们需要一个注册中心；同时RPC的通信方式我们也要考虑到； 最后网络通信的过程中也离不开字节的序列化工具 ，因此本次的技术栈选型如下：</p><table><thead><tr><th>类型</th><th>技术选型</th></tr></thead><tbody><tr><td>开发框架</td><td>Spring Boot 3</td></tr><tr><td>注册中心</td><td>Zookeeper</td></tr><tr><td>网络通信</td><td>Netty</td></tr><tr><td>序列化工具</td><td>Protostuff</td></tr></tbody></table><h2 id="整体流程" tabindex="-1">整体流程 <a class="header-anchor" href="#整体流程" aria-label="Permalink to &quot;整体流程&quot;">​</a></h2><p>一次完整的rpc的流程一般如下：</p><ol><li>服务提供方(provider)将自己的服务信息发布到注册中心，比如：服务名称、版本、ip、端口等信息</li><li>服务提供方(provider)提供facade包给服务消费方(consumer)，facade包中已经包含请求需要的对象信息、方法名称等</li><li>服务消费方(consumer)引入facade包，通过RPC方式调用到服务提供方(provider)，并拿到返回结果</li></ol><h2 id="服务注册" tabindex="-1">服务注册 <a class="header-anchor" href="#服务注册" aria-label="Permalink to &quot;服务注册&quot;">​</a></h2><h3 id="服务方注解" tabindex="-1">服务方注解 <a class="header-anchor" href="#服务方注解" aria-label="Permalink to &quot;服务方注解&quot;">​</a></h3><ol><li>我们可以通过<code>Spring AOP</code>的功能，定义一个注解<code>@RpcProvider</code></li></ol><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code"><code><span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Target</span><span style="color:#ADBAC7;">(ElementType.FIELD)</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Retention</span><span style="color:#ADBAC7;">(RetentionPolicy.RUNTIME)</span></span>
<span class="line"><span style="color:#F47067;">public</span><span style="color:#ADBAC7;"> @</span><span style="color:#F47067;">interface</span><span style="color:#F47067;"> RpcConsumer</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">   // 服务类型（被暴露的实现类的接口类型）</span></span>
<span class="line"><span style="color:#ADBAC7;">   Class</span><span style="color:#F47067;">&lt;?&gt;</span><span style="color:#DCBDFB;"> interfaceName</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">   // 服务版本（默认为空）</span></span>
<span class="line"><span style="color:#ADBAC7;">   String </span><span style="color:#DCBDFB;">version</span><span style="color:#ADBAC7;">() </span><span style="color:#F47067;">default</span><span style="color:#96D0FF;"> &quot;&quot;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span></code></pre></div><ol start="2"><li>这样我们就能批量的拿到所有加了这个注解的RPC服务， 并将其注册到<code>Zookeeper</code>中</li></ol><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code"><code><span class="line"><span style="color:#F47067;">public</span><span style="color:#F47067;"> class</span><span style="color:#F69D50;"> RpcProviderBeanPostProcessor</span><span style="color:#F47067;"> implements</span><span style="color:#6CB6FF;"> BeanPostProcessor</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">   @</span><span style="color:#F47067;">Resource</span></span>
<span class="line"><span style="color:#F47067;">   private</span><span style="color:#ADBAC7;"> RpcServiceManager</span><span style="color:#ADBAC7;"> rpcServiceManager;</span></span>
<span class="line"><span style="color:#ADBAC7;">   @</span><span style="color:#F47067;">Resource</span></span>
<span class="line"><span style="color:#F47067;">   private</span><span style="color:#ADBAC7;"> ZookeeperRegistryService</span><span style="color:#ADBAC7;"> zookeeperRegistryService;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">   @</span><span style="color:#F47067;">Override</span></span>
<span class="line"><span style="color:#F47067;">   public</span><span style="color:#ADBAC7;"> Object </span><span style="color:#DCBDFB;">postProcessBeforeInitialization</span><span style="color:#ADBAC7;">(Object </span><span style="color:#F69D50;">bean</span><span style="color:#ADBAC7;">, String </span><span style="color:#F69D50;">beanName</span><span style="color:#ADBAC7;">) </span><span style="color:#F47067;">throws</span><span style="color:#ADBAC7;"> BeansException {</span></span>
<span class="line"><span style="color:#ADBAC7;">      RpcProvider</span><span style="color:#ADBAC7;"> rpcProvider</span><span style="color:#F47067;"> =</span><span style="color:#ADBAC7;"> AnnotationUtils.</span><span style="color:#DCBDFB;">findAnnotation</span><span style="color:#ADBAC7;">(bean.</span><span style="color:#DCBDFB;">getClass</span><span style="color:#ADBAC7;">(), RpcProvider.class);</span></span>
<span class="line"><span style="color:#F47067;">      if</span><span style="color:#ADBAC7;"> (rpcProvider </span><span style="color:#F47067;">!=</span><span style="color:#6CB6FF;"> null</span><span style="color:#ADBAC7;">) {</span></span>
<span class="line"><span style="color:#768390;">         // 获取服务名称</span></span>
<span class="line"><span style="color:#ADBAC7;">         String</span><span style="color:#ADBAC7;"> name</span><span style="color:#F47067;"> =</span><span style="color:#ADBAC7;"> rpcProvider.</span><span style="color:#DCBDFB;">interfaceName</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">getName</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#768390;">         // 获取服务版本</span></span>
<span class="line"><span style="color:#ADBAC7;">         String</span><span style="color:#ADBAC7;"> version</span><span style="color:#F47067;"> =</span><span style="color:#ADBAC7;"> rpcProvider.</span><span style="color:#DCBDFB;">version</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#768390;">         // 保存服务到map中</span></span>
<span class="line"><span style="color:#ADBAC7;">         rpcServiceManager.</span><span style="color:#DCBDFB;">addService</span><span style="color:#ADBAC7;">(String.</span><span style="color:#DCBDFB;">join</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;-&quot;</span><span style="color:#ADBAC7;">, name, version), bean);</span></span>
<span class="line"><span style="color:#768390;">         // 注册服务</span></span>
<span class="line"><span style="color:#ADBAC7;">         zookeeperRegistryService.</span><span style="color:#DCBDFB;">register</span><span style="color:#ADBAC7;">(name </span><span style="color:#F47067;">+</span><span style="color:#96D0FF;"> &quot;-&quot;</span><span style="color:#F47067;"> +</span><span style="color:#ADBAC7;"> version);</span></span>
<span class="line"><span style="color:#ADBAC7;">      }</span></span>
<span class="line"><span style="color:#F47067;">      return</span><span style="color:#ADBAC7;"> bean;</span></span>
<span class="line"><span style="color:#ADBAC7;">   }</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span></code></pre></div><h3 id="服务监听" tabindex="-1">服务监听 <a class="header-anchor" href="#服务监听" aria-label="Permalink to &quot;服务监听&quot;">​</a></h3><p>我们使用<code>Netty</code>来监听RPC服务的请求，因此就要新增一个<code>ChannelHandlerAdapter</code>来处理相应的逻辑，核心代码如下：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code"><code><span class="line"><span style="color:#F47067;">public</span><span style="color:#F47067;"> class</span><span style="color:#F69D50;"> NettyRpcServerHandler</span><span style="color:#F47067;"> extends</span><span style="color:#6CB6FF;"> SimpleChannelInboundHandler</span><span style="color:#ADBAC7;">&lt;</span><span style="color:#F47067;">RpcRequest</span><span style="color:#ADBAC7;">&gt; {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">   // 存储服务名称及服务对象之间的映射关系</span></span>
<span class="line"><span style="color:#F47067;">   private</span><span style="color:#F47067;"> final</span><span style="color:#ADBAC7;"> Map</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">String</span><span style="color:#F69D50;">, </span><span style="color:#F47067;">Object</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">handlerMap;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F47067;">   private</span><span style="color:#ADBAC7;"> Object </span><span style="color:#DCBDFB;">handle</span><span style="color:#ADBAC7;">(RpcRequest </span><span style="color:#F69D50;">rpcRequest</span><span style="color:#ADBAC7;">) </span><span style="color:#F47067;">throws</span><span style="color:#ADBAC7;"> NoSuchMethodException, InvocationTargetException, IllegalAccessException {</span></span>
<span class="line"><span style="color:#ADBAC7;">      String</span><span style="color:#ADBAC7;"> name</span><span style="color:#F47067;"> =</span><span style="color:#ADBAC7;"> rpcRequest.</span><span style="color:#DCBDFB;">getInterfaceName</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#ADBAC7;">      String</span><span style="color:#ADBAC7;"> version</span><span style="color:#F47067;"> =</span><span style="color:#ADBAC7;"> rpcRequest.</span><span style="color:#DCBDFB;">getVersion</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">      // 获取服务对象</span></span>
<span class="line"><span style="color:#ADBAC7;">      Object</span><span style="color:#ADBAC7;"> serviceBean</span><span style="color:#F47067;"> =</span><span style="color:#ADBAC7;"> handlerMap.</span><span style="color:#DCBDFB;">get</span><span style="color:#ADBAC7;">(String.</span><span style="color:#DCBDFB;">join</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;-&quot;</span><span style="color:#ADBAC7;">, name, version));</span></span>
<span class="line"><span style="color:#F47067;">      if</span><span style="color:#ADBAC7;"> (serviceBean </span><span style="color:#F47067;">==</span><span style="color:#6CB6FF;"> null</span><span style="color:#ADBAC7;">) {</span></span>
<span class="line"><span style="color:#F47067;">         throw</span><span style="color:#F47067;"> new</span><span style="color:#DCBDFB;"> RuntimeException</span><span style="color:#ADBAC7;">(String.</span><span style="color:#DCBDFB;">format</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;can not find service bean by key: %s&quot;</span><span style="color:#ADBAC7;">, name));</span></span>
<span class="line"><span style="color:#ADBAC7;">      }</span></span>
<span class="line"><span style="color:#768390;">      // 获取反射调用所需的参数</span></span>
<span class="line"><span style="color:#ADBAC7;">      Class</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">?</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">serviceClass</span><span style="color:#F47067;"> =</span><span style="color:#ADBAC7;"> serviceBean.</span><span style="color:#DCBDFB;">getClass</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#ADBAC7;">      String</span><span style="color:#ADBAC7;"> methodName</span><span style="color:#F47067;"> =</span><span style="color:#ADBAC7;"> rpcRequest.</span><span style="color:#DCBDFB;">getMethodName</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#F47067;">      Object</span><span style="color:#F69D50;">[] </span><span style="color:#ADBAC7;">parameters</span><span style="color:#F47067;"> =</span><span style="color:#ADBAC7;"> rpcRequest.</span><span style="color:#DCBDFB;">getParameters</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#ADBAC7;">      Class</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">?</span><span style="color:#F69D50;">&gt;[] </span><span style="color:#ADBAC7;">parameterTypes</span><span style="color:#F47067;"> =</span><span style="color:#ADBAC7;"> rpcRequest.</span><span style="color:#DCBDFB;">getParameterTypes</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#768390;">      // 通过反射调用客户端请求的方法</span></span>
<span class="line"><span style="color:#ADBAC7;">      Method</span><span style="color:#ADBAC7;"> method</span><span style="color:#F47067;"> =</span><span style="color:#ADBAC7;"> serviceClass.</span><span style="color:#DCBDFB;">getMethod</span><span style="color:#ADBAC7;">(methodName, parameterTypes);</span></span>
<span class="line"><span style="color:#ADBAC7;">      method.</span><span style="color:#DCBDFB;">setAccessible</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">true</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#F47067;">      return</span><span style="color:#ADBAC7;"> method.</span><span style="color:#DCBDFB;">invoke</span><span style="color:#ADBAC7;">(serviceBean, parameters);</span></span>
<span class="line"><span style="color:#ADBAC7;">   }</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span></code></pre></div><h2 id="服务消费" tabindex="-1">服务消费 <a class="header-anchor" href="#服务消费" aria-label="Permalink to &quot;服务消费&quot;">​</a></h2><h3 id="消费者注解" tabindex="-1">消费者注解 <a class="header-anchor" href="#消费者注解" aria-label="Permalink to &quot;消费者注解&quot;">​</a></h3><p>和之前类似，我们依旧通过自定义注解的方式获取到所有的RPC引用</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code"><code><span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Target</span><span style="color:#ADBAC7;">(ElementType.FIELD)</span></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Retention</span><span style="color:#ADBAC7;">(RetentionPolicy.RUNTIME)</span></span>
<span class="line"><span style="color:#F47067;">public</span><span style="color:#ADBAC7;"> @</span><span style="color:#F47067;">interface</span><span style="color:#F47067;"> RpcConsumer</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">   // 服务类型（被暴露的实现类的接口类型）</span></span>
<span class="line"><span style="color:#ADBAC7;">   Class</span><span style="color:#F47067;">&lt;?&gt;</span><span style="color:#DCBDFB;"> interfaceName</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">   // 服务版本（默认为空）</span></span>
<span class="line"><span style="color:#ADBAC7;">   String </span><span style="color:#DCBDFB;">version</span><span style="color:#ADBAC7;">() </span><span style="color:#F47067;">default</span><span style="color:#96D0FF;"> &quot;&quot;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span></code></pre></div><h3 id="动态代理" tabindex="-1">动态代理 <a class="header-anchor" href="#动态代理" aria-label="Permalink to &quot;动态代理&quot;">​</a></h3><p>但是这样就有一个问题：因为消费者当前引用的这个RPC服务只是个空接口，并不是一个具体的类， 因此我们需要通过<code>Spring AOP</code>将其替换为代理类，代理类负责将请求参数包装，然后发送给RPC服务方，然后拿到返回结果。</p><p>具体实现方式如下：</p><ol><li>通过<code>BeanPostProcessor</code>拿到bean，遍历其所有字段，如果有<code>@RpcConsumer</code>注解，则将该字段的替换相应的的动态代理类</li></ol><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code"><code><span class="line"><span style="color:#F47067;">public</span><span style="color:#F47067;"> class</span><span style="color:#F69D50;"> RpcConsumerBeanPostProcessor</span><span style="color:#F47067;"> implements</span><span style="color:#6CB6FF;"> BeanPostProcessor</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">   @</span><span style="color:#F47067;">Autowired</span></span>
<span class="line"><span style="color:#F47067;">   private</span><span style="color:#ADBAC7;"> ServiceDiscovery</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">ZookeeperInstance</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">serviceDiscovery;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">   @</span><span style="color:#F47067;">Override</span></span>
<span class="line"><span style="color:#F47067;">   public</span><span style="color:#ADBAC7;"> Object </span><span style="color:#DCBDFB;">postProcessAfterInitialization</span><span style="color:#ADBAC7;">(Object </span><span style="color:#F69D50;">bean</span><span style="color:#ADBAC7;">, String </span><span style="color:#F69D50;">beanName</span><span style="color:#ADBAC7;">) </span><span style="color:#F47067;">throws</span><span style="color:#ADBAC7;"> BeansException {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">      Class</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">?</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">clazz</span><span style="color:#F47067;"> =</span><span style="color:#ADBAC7;"> bean.</span><span style="color:#DCBDFB;">getClass</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#F47067;">      Field</span><span style="color:#F69D50;">[] </span><span style="color:#ADBAC7;">declaredFields</span><span style="color:#F47067;"> =</span><span style="color:#ADBAC7;"> clazz.</span><span style="color:#DCBDFB;">getDeclaredFields</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#F47067;">      for</span><span style="color:#ADBAC7;"> (Field</span><span style="color:#ADBAC7;"> field</span><span style="color:#F47067;"> :</span><span style="color:#ADBAC7;"> declaredFields) {</span></span>
<span class="line"><span style="color:#ADBAC7;">         RpcConsumer</span><span style="color:#ADBAC7;"> annotation</span><span style="color:#F47067;"> =</span><span style="color:#ADBAC7;"> field.</span><span style="color:#DCBDFB;">getAnnotation</span><span style="color:#ADBAC7;">(RpcConsumer.class);</span></span>
<span class="line"><span style="color:#F47067;">         if</span><span style="color:#ADBAC7;"> (annotation </span><span style="color:#F47067;">==</span><span style="color:#6CB6FF;"> null</span><span style="color:#ADBAC7;">) {</span></span>
<span class="line"><span style="color:#F47067;">            continue</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">         }</span></span>
<span class="line"><span style="color:#ADBAC7;">         Class</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">?</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">interfaceClass</span><span style="color:#F47067;"> =</span><span style="color:#ADBAC7;"> annotation.</span><span style="color:#DCBDFB;">interfaceName</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#ADBAC7;">         String</span><span style="color:#ADBAC7;"> version</span><span style="color:#F47067;"> =</span><span style="color:#ADBAC7;"> annotation.</span><span style="color:#DCBDFB;">version</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">         RpcProxy</span><span style="color:#ADBAC7;"> rpcProxy</span><span style="color:#F47067;"> =</span><span style="color:#F47067;"> new</span><span style="color:#DCBDFB;"> RpcProxy</span><span style="color:#ADBAC7;">(serviceDiscovery);</span></span>
<span class="line"><span style="color:#ADBAC7;">         Object</span><span style="color:#ADBAC7;"> proxy</span><span style="color:#F47067;"> =</span><span style="color:#ADBAC7;"> rpcProxy.</span><span style="color:#DCBDFB;">create</span><span style="color:#ADBAC7;">(interfaceClass, version);</span></span>
<span class="line"><span style="color:#ADBAC7;">         field.</span><span style="color:#DCBDFB;">setAccessible</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">true</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#F47067;">         try</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">            field.</span><span style="color:#DCBDFB;">set</span><span style="color:#ADBAC7;">(bean, proxy);</span></span>
<span class="line"><span style="color:#ADBAC7;">         } </span><span style="color:#F47067;">catch</span><span style="color:#ADBAC7;"> (IllegalAccessException </span><span style="color:#F69D50;">e</span><span style="color:#ADBAC7;">) {</span></span>
<span class="line"><span style="color:#ADBAC7;">            e.</span><span style="color:#DCBDFB;">printStackTrace</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#ADBAC7;">         }</span></span>
<span class="line"><span style="color:#ADBAC7;">      }</span></span>
<span class="line"><span style="color:#F47067;">      return</span><span style="color:#ADBAC7;"> bean;</span></span>
<span class="line"><span style="color:#ADBAC7;">   }</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span></code></pre></div><ol start="2"><li>动态代理实现方式： <ol><li>拿到注解的参数：接口名称、版本号，以便查询<code>Zookeeper</code>获取相应的服务信息</li><li>拿到请求参数，使用<code>Netty</code>进行远程调用</li></ol></li></ol><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code"><code><span class="line"><span style="color:#F47067;">public</span><span style="color:#F47067;"> class</span><span style="color:#F69D50;"> RpcProxy</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F47067;">   private</span><span style="color:#ADBAC7;"> ServiceDiscovery</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">ZookeeperInstance</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">serviceDiscovery;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">   /**</span></span>
<span class="line"><span style="color:#768390;">    * 该构造函数用于提供给用户通过配置文件注入服务发现组件</span></span>
<span class="line"><span style="color:#768390;">    */</span></span>
<span class="line"><span style="color:#F47067;">   public</span><span style="color:#DCBDFB;"> RpcProxy</span><span style="color:#ADBAC7;">(ServiceDiscovery&lt;</span><span style="color:#F47067;">ZookeeperInstance</span><span style="color:#ADBAC7;">&gt; </span><span style="color:#F69D50;">serviceDiscovery</span><span style="color:#ADBAC7;">) {</span></span>
<span class="line"><span style="color:#6CB6FF;">      this</span><span style="color:#ADBAC7;">.serviceDiscovery </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> serviceDiscovery;</span></span>
<span class="line"><span style="color:#ADBAC7;">   }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F47067;">   public</span><span style="color:#ADBAC7;"> Object </span><span style="color:#DCBDFB;">create</span><span style="color:#ADBAC7;">(Class&lt;</span><span style="color:#F47067;">?</span><span style="color:#ADBAC7;">&gt; </span><span style="color:#F69D50;">interfaceClass</span><span style="color:#ADBAC7;">, String </span><span style="color:#F69D50;">version</span><span style="color:#ADBAC7;">) {</span></span>
<span class="line"><span style="color:#768390;">      // 使用 CGLIB 动态代理机制</span></span>
<span class="line"><span style="color:#ADBAC7;">      Enhancer</span><span style="color:#ADBAC7;"> enhancer</span><span style="color:#F47067;"> =</span><span style="color:#F47067;"> new</span><span style="color:#DCBDFB;"> Enhancer</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#ADBAC7;">      enhancer.</span><span style="color:#DCBDFB;">setClassLoader</span><span style="color:#ADBAC7;">(interfaceClass.</span><span style="color:#DCBDFB;">getClassLoader</span><span style="color:#ADBAC7;">());</span></span>
<span class="line"><span style="color:#ADBAC7;">      enhancer.</span><span style="color:#DCBDFB;">setSuperclass</span><span style="color:#ADBAC7;">(interfaceClass);</span></span>
<span class="line"><span style="color:#ADBAC7;">      enhancer.</span><span style="color:#DCBDFB;">setCallback</span><span style="color:#ADBAC7;">(</span></span>
<span class="line"><span style="color:#ADBAC7;">              (MethodInterceptor) (obj, method, args, proxy) </span><span style="color:#F47067;">-&gt;</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#768390;">                 // 创建 RPC 请求并设置属性</span></span>
<span class="line"><span style="color:#ADBAC7;">                 RpcRequest</span><span style="color:#ADBAC7;"> rpcRequest</span><span style="color:#F47067;"> =</span><span style="color:#F47067;"> new</span><span style="color:#DCBDFB;"> RpcRequest</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#ADBAC7;">                 rpcRequest.</span><span style="color:#DCBDFB;">setRequestId</span><span style="color:#ADBAC7;">(UUID.</span><span style="color:#DCBDFB;">randomUUID</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">toString</span><span style="color:#ADBAC7;">());</span></span>
<span class="line"><span style="color:#ADBAC7;">                 rpcRequest.</span><span style="color:#DCBDFB;">setMethodName</span><span style="color:#ADBAC7;">(method.</span><span style="color:#DCBDFB;">getName</span><span style="color:#ADBAC7;">());</span></span>
<span class="line"><span style="color:#ADBAC7;">                 rpcRequest.</span><span style="color:#DCBDFB;">setParameterTypes</span><span style="color:#ADBAC7;">(method.</span><span style="color:#DCBDFB;">getParameterTypes</span><span style="color:#ADBAC7;">());</span></span>
<span class="line"><span style="color:#ADBAC7;">                 rpcRequest.</span><span style="color:#DCBDFB;">setParameters</span><span style="color:#ADBAC7;">(args);</span></span>
<span class="line"><span style="color:#ADBAC7;">                 rpcRequest.</span><span style="color:#DCBDFB;">setInterfaceName</span><span style="color:#ADBAC7;">(interfaceClass.</span><span style="color:#DCBDFB;">getName</span><span style="color:#ADBAC7;">());</span></span>
<span class="line"><span style="color:#ADBAC7;">                 rpcRequest.</span><span style="color:#DCBDFB;">setVersion</span><span style="color:#ADBAC7;">(version);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">                 //查询zookeeper</span></span>
<span class="line"><span style="color:#ADBAC7;">                 ServiceInstance</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">ZookeeperInstance</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">instance</span><span style="color:#F47067;"> =</span><span style="color:#DCBDFB;"> getInstance</span><span style="color:#ADBAC7;">(rpcRequest.</span><span style="color:#DCBDFB;">getInterfaceName</span><span style="color:#ADBAC7;">(), rpcRequest.</span><span style="color:#DCBDFB;">getVersion</span><span style="color:#ADBAC7;">());</span></span>
<span class="line"><span style="color:#F47067;">                 if</span><span style="color:#ADBAC7;"> (instance </span><span style="color:#F47067;">==</span><span style="color:#6CB6FF;"> null</span><span style="color:#ADBAC7;">) {</span></span>
<span class="line"><span style="color:#F47067;">                    throw</span><span style="color:#F47067;"> new</span><span style="color:#DCBDFB;"> RuntimeException</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;server address is empty&quot;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#ADBAC7;">                 }</span></span>
<span class="line"><span style="color:#768390;">                 // 创建 RPC 客户端对象，建立连接/发送请求/接收请求</span></span>
<span class="line"><span style="color:#ADBAC7;">                 NettyRpcClientHandler</span><span style="color:#ADBAC7;"> handler</span><span style="color:#F47067;"> =</span><span style="color:#F47067;"> new</span><span style="color:#DCBDFB;"> NettyRpcClientHandler</span><span style="color:#ADBAC7;">(instance.</span><span style="color:#DCBDFB;">getAddress</span><span style="color:#ADBAC7;">(), instance.</span><span style="color:#DCBDFB;">getPort</span><span style="color:#ADBAC7;">());</span></span>
<span class="line"><span style="color:#ADBAC7;">                 RpcResponse</span><span style="color:#ADBAC7;"> rpcResponse</span><span style="color:#F47067;"> =</span><span style="color:#ADBAC7;"> handler.</span><span style="color:#DCBDFB;">send</span><span style="color:#ADBAC7;">(rpcRequest);</span></span>
<span class="line"><span style="color:#F47067;">                 if</span><span style="color:#ADBAC7;"> (rpcResponse </span><span style="color:#F47067;">==</span><span style="color:#6CB6FF;"> null</span><span style="color:#ADBAC7;">) {</span></span>
<span class="line"><span style="color:#F47067;">                    throw</span><span style="color:#F47067;"> new</span><span style="color:#DCBDFB;"> RuntimeException</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;response is null&quot;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#ADBAC7;">                 }</span></span>
<span class="line"><span style="color:#F47067;">                 return</span><span style="color:#ADBAC7;"> rpcResponse.</span><span style="color:#DCBDFB;">getData</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#ADBAC7;">              });</span></span>
<span class="line"><span style="color:#F47067;">      return</span><span style="color:#ADBAC7;"> enhancer.</span><span style="color:#DCBDFB;">create</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#ADBAC7;">   }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F47067;">   private</span><span style="color:#ADBAC7;"> ServiceInstance&lt;</span><span style="color:#F47067;">ZookeeperInstance</span><span style="color:#ADBAC7;">&gt; </span><span style="color:#DCBDFB;">getInstance</span><span style="color:#ADBAC7;">(String </span><span style="color:#F69D50;">interfaceName</span><span style="color:#ADBAC7;">, String </span><span style="color:#F69D50;">version</span><span style="color:#ADBAC7;">) </span><span style="color:#F47067;">throws</span><span style="color:#ADBAC7;"> Exception {</span></span>
<span class="line"><span style="color:#ADBAC7;">      String</span><span style="color:#ADBAC7;"> name</span><span style="color:#F47067;"> =</span><span style="color:#ADBAC7;"> String.</span><span style="color:#DCBDFB;">join</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;-&quot;</span><span style="color:#ADBAC7;">, interfaceName, version);</span></span>
<span class="line"><span style="color:#ADBAC7;">      Collection</span><span style="color:#F69D50;">&lt;</span><span style="color:#ADBAC7;">ServiceInstance</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">ZookeeperInstance</span><span style="color:#F69D50;">&gt;&gt; </span><span style="color:#ADBAC7;">serviceInstances</span><span style="color:#F47067;"> =</span><span style="color:#ADBAC7;"> serviceDiscovery.</span><span style="color:#DCBDFB;">queryForInstances</span><span style="color:#ADBAC7;">(name);</span></span>
<span class="line"><span style="color:#ADBAC7;">      Optional</span><span style="color:#F69D50;">&lt;</span><span style="color:#ADBAC7;">ServiceInstance</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">ZookeeperInstance</span><span style="color:#F69D50;">&gt;&gt; </span><span style="color:#ADBAC7;">first</span><span style="color:#F47067;"> =</span><span style="color:#ADBAC7;"> serviceInstances.</span><span style="color:#DCBDFB;">stream</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">findFirst</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#F47067;">      return</span><span style="color:#ADBAC7;"> first.</span><span style="color:#DCBDFB;">orElse</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">null</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#ADBAC7;">   }</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span></code></pre></div><h2 id="编解码" tabindex="-1">编解码 <a class="header-anchor" href="#编解码" aria-label="Permalink to &quot;编解码&quot;">​</a></h2><p>这一块比较简单，就是继承<code>Netty</code>提供的ByteToMessageDecoder、MessageToByteEncoder就可以了，完整代码如下：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code"><code><span class="line"><span style="color:#768390;">// 编码</span></span>
<span class="line"><span style="color:#F47067;">public</span><span style="color:#F47067;"> class</span><span style="color:#F69D50;"> RpcMessageEncoder</span><span style="color:#F47067;"> extends</span><span style="color:#6CB6FF;"> MessageToByteEncoder</span><span style="color:#ADBAC7;">&lt;</span><span style="color:#F47067;">Object</span><span style="color:#ADBAC7;">&gt; {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F47067;">   private</span><span style="color:#ADBAC7;"> Class</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">?</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">clazz;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F47067;">   public</span><span style="color:#DCBDFB;"> RpcMessageEncoder</span><span style="color:#ADBAC7;">(Class&lt;</span><span style="color:#F47067;">?</span><span style="color:#ADBAC7;">&gt; </span><span style="color:#F69D50;">clazz</span><span style="color:#ADBAC7;">) {</span></span>
<span class="line"><span style="color:#6CB6FF;">      this</span><span style="color:#ADBAC7;">.clazz </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> clazz;</span></span>
<span class="line"><span style="color:#ADBAC7;">   }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">   @</span><span style="color:#F47067;">Override</span></span>
<span class="line"><span style="color:#F47067;">   protected</span><span style="color:#F47067;"> void</span><span style="color:#DCBDFB;"> encode</span><span style="color:#ADBAC7;">(ChannelHandlerContext </span><span style="color:#F69D50;">ctx</span><span style="color:#ADBAC7;">, Object </span><span style="color:#F69D50;">msg</span><span style="color:#ADBAC7;">, ByteBuf </span><span style="color:#F69D50;">out</span><span style="color:#ADBAC7;">) </span><span style="color:#F47067;">throws</span><span style="color:#ADBAC7;"> Exception {</span></span>
<span class="line"><span style="color:#F47067;">      byte</span><span style="color:#F69D50;">[] </span><span style="color:#ADBAC7;">data</span><span style="color:#F47067;"> =</span><span style="color:#ADBAC7;"> ProtostuffSerializer.</span><span style="color:#DCBDFB;">serialize</span><span style="color:#ADBAC7;">(msg, clazz); </span><span style="color:#768390;">// 将对象序列化为字节数组</span></span>
<span class="line"><span style="color:#ADBAC7;">      out.</span><span style="color:#DCBDFB;">writeInt</span><span style="color:#ADBAC7;">(data.length); </span><span style="color:#768390;">// 将消息体长度写入消息头</span></span>
<span class="line"><span style="color:#ADBAC7;">      out.</span><span style="color:#DCBDFB;">writeBytes</span><span style="color:#ADBAC7;">(data); </span><span style="color:#768390;">// 将数据写入消息体</span></span>
<span class="line"><span style="color:#ADBAC7;">   }</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span></code></pre></div><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code"><code><span class="line"><span style="color:#768390;">// 解码</span></span>
<span class="line"><span style="color:#F47067;">public</span><span style="color:#F47067;"> class</span><span style="color:#F69D50;"> RpcMessageDecoder</span><span style="color:#F47067;"> extends</span><span style="color:#6CB6FF;"> ByteToMessageDecoder</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F47067;">   private</span><span style="color:#ADBAC7;"> Class</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">?</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">clazz;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F47067;">   public</span><span style="color:#DCBDFB;"> RpcMessageDecoder</span><span style="color:#ADBAC7;">(Class&lt;</span><span style="color:#F47067;">?</span><span style="color:#ADBAC7;">&gt; </span><span style="color:#F69D50;">clazz</span><span style="color:#ADBAC7;">) {</span></span>
<span class="line"><span style="color:#6CB6FF;">      this</span><span style="color:#ADBAC7;">.clazz </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> clazz;</span></span>
<span class="line"><span style="color:#ADBAC7;">   }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">   @</span><span style="color:#F47067;">Override</span></span>
<span class="line"><span style="color:#F47067;">   protected</span><span style="color:#F47067;"> void</span><span style="color:#DCBDFB;"> decode</span><span style="color:#ADBAC7;">(ChannelHandlerContext </span><span style="color:#F69D50;">ctx</span><span style="color:#ADBAC7;">, ByteBuf </span><span style="color:#F69D50;">in</span><span style="color:#ADBAC7;">, List&lt;</span><span style="color:#F47067;">Object</span><span style="color:#ADBAC7;">&gt; </span><span style="color:#F69D50;">out</span><span style="color:#ADBAC7;">) </span><span style="color:#F47067;">throws</span><span style="color:#ADBAC7;"> Exception {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">      // 标记当前readIndex的位置，以便后面重置 readIndex 的时候使用</span></span>
<span class="line"><span style="color:#ADBAC7;">      in.</span><span style="color:#DCBDFB;">markReaderIndex</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#768390;">      // 读取消息体（消息的长度）. readInt 操作会增加 readerIndex</span></span>
<span class="line"><span style="color:#F47067;">      int</span><span style="color:#ADBAC7;"> length</span><span style="color:#F47067;"> =</span><span style="color:#ADBAC7;"> in.</span><span style="color:#DCBDFB;">readInt</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#768390;">      // 如果可读字节数小于消息长度，说明是不完整的消息</span></span>
<span class="line"><span style="color:#F47067;">      if</span><span style="color:#ADBAC7;"> (in.</span><span style="color:#DCBDFB;">readableBytes</span><span style="color:#ADBAC7;">() </span><span style="color:#F47067;">&lt;</span><span style="color:#ADBAC7;"> length) {</span></span>
<span class="line"><span style="color:#ADBAC7;">         in.</span><span style="color:#DCBDFB;">resetReaderIndex</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#F47067;">         return</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">      }</span></span>
<span class="line"><span style="color:#768390;">      // 开始反序列化</span></span>
<span class="line"><span style="color:#F47067;">      byte</span><span style="color:#F69D50;">[] </span><span style="color:#ADBAC7;">body</span><span style="color:#F47067;"> =</span><span style="color:#F47067;"> new</span><span style="color:#F47067;"> byte</span><span style="color:#ADBAC7;">[length];</span></span>
<span class="line"><span style="color:#ADBAC7;">      in.</span><span style="color:#DCBDFB;">readBytes</span><span style="color:#ADBAC7;">(body);</span></span>
<span class="line"><span style="color:#ADBAC7;">      Object</span><span style="color:#ADBAC7;"> obj</span><span style="color:#F47067;"> =</span><span style="color:#ADBAC7;"> ProtostuffSerializer.</span><span style="color:#DCBDFB;">deserialize</span><span style="color:#ADBAC7;">(body, clazz);</span></span>
<span class="line"><span style="color:#ADBAC7;">      out.</span><span style="color:#DCBDFB;">add</span><span style="color:#ADBAC7;">(obj);</span></span>
<span class="line"><span style="color:#ADBAC7;">   }</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span></code></pre></div><h2 id="自动装配" tabindex="-1">自动装配 <a class="header-anchor" href="#自动装配" aria-label="Permalink to &quot;自动装配&quot;">​</a></h2><p>至此整体的流程已经全部实现好了，但是我们一般希望把RPC框架作为一个依赖包提供出去的， 因此可以基于Spring的自动装配功能来提供开箱即用的便利性。</p><p>以rpc-provider模块为例，首先定义一个配置类<code>RpcProviderConfiguration</code>用来装配我们需要的bean</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code"><code><span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">@</span><span style="color:#F47067;">Configuration</span></span>
<span class="line"><span style="color:#F47067;">public</span><span style="color:#F47067;"> class</span><span style="color:#F69D50;"> RpcProviderConfiguration</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">   @</span><span style="color:#F47067;">Bean</span></span>
<span class="line"><span style="color:#ADBAC7;">   @</span><span style="color:#F47067;">ConditionalOnMissingBean</span></span>
<span class="line"><span style="color:#F47067;">   public</span><span style="color:#ADBAC7;"> NettyServerListener </span><span style="color:#DCBDFB;">nettyServerListener</span><span style="color:#ADBAC7;">() {</span></span>
<span class="line"><span style="color:#F47067;">      return</span><span style="color:#F47067;"> new</span><span style="color:#DCBDFB;"> NettyServerListener</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#ADBAC7;">   }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">   @</span><span style="color:#F47067;">Bean</span></span>
<span class="line"><span style="color:#ADBAC7;">   @</span><span style="color:#F47067;">ConditionalOnMissingBean</span></span>
<span class="line"><span style="color:#F47067;">   public</span><span style="color:#ADBAC7;"> RpcProviderBeanPostProcessor </span><span style="color:#DCBDFB;">rpcProviderBeanPostProcessor</span><span style="color:#ADBAC7;">() {</span></span>
<span class="line"><span style="color:#F47067;">      return</span><span style="color:#F47067;"> new</span><span style="color:#DCBDFB;"> RpcProviderBeanPostProcessor</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#ADBAC7;">   }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">   @</span><span style="color:#F47067;">Bean</span></span>
<span class="line"><span style="color:#ADBAC7;">   @</span><span style="color:#F47067;">ConditionalOnMissingBean</span></span>
<span class="line"><span style="color:#F47067;">   public</span><span style="color:#ADBAC7;"> ZookeeperRegistryService </span><span style="color:#DCBDFB;">zookeeperRegistryService</span><span style="color:#ADBAC7;">() {</span></span>
<span class="line"><span style="color:#F47067;">      return</span><span style="color:#F47067;"> new</span><span style="color:#DCBDFB;"> ZookeeperRegistryService</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#ADBAC7;">   }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">   @</span><span style="color:#F47067;">Bean</span></span>
<span class="line"><span style="color:#ADBAC7;">   @</span><span style="color:#F47067;">ConditionalOnMissingBean</span></span>
<span class="line"><span style="color:#F47067;">   public</span><span style="color:#ADBAC7;"> RpcServiceManager </span><span style="color:#DCBDFB;">rpcServiceManager</span><span style="color:#ADBAC7;">() {</span></span>
<span class="line"><span style="color:#F47067;">      return</span><span style="color:#F47067;"> new</span><span style="color:#DCBDFB;"> RpcServiceManager</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#ADBAC7;">   }</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span></code></pre></div><p>然后我们需要在<code>META-INF/spring/</code>目录创建文件<code>org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>（这是Spring Boot 3.0的新规定）， 文件内容填写配置类的包路径即可</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark-dimmed vp-code"><code><span class="line"><span>config.RpcProviderConfiguration</span></span></code></pre></div><h2 id="参考" tabindex="-1">参考 <a class="header-anchor" href="#参考" aria-label="Permalink to &quot;参考&quot;">​</a></h2><ul><li><a href="https://github.com/Snailclimb/guide-rpc-framework" target="_blank" rel="noreferrer">《手写 RPC 框架》</a></li><li><a href="https://github.com/Veal98/RPC-FromScratch/blob/master/rpc-sample-server/src/main/java/com/cswiki/rpc/sample/server/HelloServiceImpl1.java" target="_blank" rel="noreferrer">从零开始设计一个轻量级分布式 RPC 框架</a></li></ul></div></div><hr class="q-separator q-separator--horizontal" style="" aria-orientation="horizontal"><div class="q-card__actions justify-start q-card__actions--horiz row"><a class="q-btn q-btn-item non-selectable no-outline q-btn--flat q-btn--rectangle text-blue-6 q-btn--actionable q-focusable q-hoverable" style="" tabindex="0" href="https://qr.alipay.com/fkx12630qiigpvf7yb0nd85"><span class="q-focus-helper"></span><span class="q-btn__content text-center col items-center q-anchor--skip justify-center row"><div>请我喝杯咖啡</div><i class="q-icon on-right" style="font-size:2em;" aria-hidden="true" role="presentation"><svg viewBox="0 0 16 16"><path style="" d="M2.541 0H13.5a2.551 2.551 0 0 1 2.54 2.563v8.297c-.006 0-.531-.046-2.978-.813-.412-.14-.916-.327-1.479-.536-.303-.113-.624-.232-.957-.353a12.98 12.98 0 0 0 1.325-3.373H8.822V4.649h3.831v-.634h-3.83V2.121H7.26c-.274 0-.274.273-.274.273v1.621H3.11v.634h3.875v1.136h-3.2v.634H9.99c-.227.789-.532 1.53-.894 2.202-2.013-.67-4.161-1.212-5.51-.878-.864.214-1.42.597-1.746.998-1.499 1.84-.424 4.633 2.741 4.633 1.872 0 3.675-1.053 5.072-2.787 2.08 1.008 6.37 2.738 6.387 2.745v.105A2.551 2.551 0 0 1 13.5 16H2.541A2.552 2.552 0 0 1 0 13.437V2.563A2.552 2.552 0 0 1 2.541 0M2.309 9.27c-1.22 1.073-.49 3.034 1.978 3.034 1.434 0 2.868-.925 3.994-2.406-1.602-.789-2.959-1.353-4.425-1.207-.397.04-1.14.217-1.547.58Z"></path></svg></i></span></a><div class="q-space"></div><a class="q-btn q-btn-item non-selectable no-outline q-btn--flat q-btn--rectangle text-teal q-btn--actionable q-focusable q-hoverable" style="" tabindex="0" href="https://github.com/YangQuan666/yangquan666.github.io/discussions"><span class="q-focus-helper"></span><span class="q-btn__content text-center col items-center q-anchor--skip justify-center row"><i class="q-icon on-left notranslate material-icons" style="font-size:2em;" aria-hidden="true" role="presentation">question_answer</i><div>给我留言</div></span></a></div></div></div><div class="q-drawer-container"><div class="q-drawer__opener fixed-right" aria-hidden="true"></div><div class="fullscreen q-drawer__backdrop hidden" style="background-color:rgba(0,0,0,0);" aria-hidden="true"></div><aside class="q-drawer q-drawer--right q-drawer--bordered q-layout--prevent-focus fixed q-drawer--on-top q-drawer--mobile q-drawer--top-padding" style="width:300px;transform:translateX(300px);"><div class="q-drawer__content fit scroll"><div class="q-scrollarea fit"><div class="q-scrollarea__container scroll relative-position fit hide-scrollbar"><div class="q-scrollarea__content absolute" style=""><!----><div class="q-list q-list--padding"><div class="q-item q-item-type row no-wrap" style="" role="listitem"><div class="q-item__section column q-item__section--main justify-center text-h5"> 目录 </div></div><!--[--><!--]--></div></div><!----></div><!----><div class="q-scrollarea__bar q-scrollarea__bar--v absolute-right q-scrollarea__bar--invisible" style="" aria-hidden="true"></div><div class="q-scrollarea__bar q-scrollarea__bar--h absolute-bottom q-scrollarea__bar--invisible" style="" aria-hidden="true"></div><div class="q-scrollarea__thumb q-scrollarea__thumb--v absolute-right q-scrollarea__thumb--invisible" style="top:0px;height:0px;" aria-hidden="true"></div><div class="q-scrollarea__thumb q-scrollarea__thumb--h absolute-bottom q-scrollarea__thumb--invisible" style="left:0px;width:0px;" aria-hidden="true"></div></div></div></aside></div><!--]--></main></div><footer class="q-footer q-layout__section--marginal absolute-bottom q-footer--bordered bg-dark text-white" style=""><!----><div class="q-toolbar row no-wrap items-center" role="toolbar">Released under the GPL License. <div class="q-space"></div><a class="q-btn q-btn-item non-selectable no-outline q-btn--flat q-btn--rectangle q-btn--actionable q-focusable q-hoverable" style="" tabindex="0" href="https://github.com/YangQuan666/yangquan666.github.io/blob/main/CHANGELOG.md"><span class="q-focus-helper"></span><span class="q-btn__content text-center col items-center q-anchor--skip justify-center row"><span class="block">Release Note</span></span></a><div class="q-badge flex inline items-center no-wrap q-badge--single-line bg-primary" style="" role="status">0.1.0</div></div></footer></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"post_hik-resume.md\":\"WAwE6M5k\",\"post_computer.md\":\"vITDh0rp\",\"post_shuangpin.md\":\"LepsQPAX\",\"post_maoism.md\":\"hZ909ab-\",\"post_cat.md\":\"XigyM_kO\",\"post_android.md\":\"lEPQIPLo\",\"post_about.md\":\"54Bay7RY\",\"game_2048_index.md\":\"1Ik0M0_H\",\"game_dinosaur_index.md\":\"uiM2yyXm\",\"post_piano.md\":\"xEWXF3MO\",\"index.md\":\"ZTxv5_Vu\",\"post_usb.md\":\"HAV90Y5E\",\"post_xbox.md\":\"dsjQGCwS\",\"post_rpc.md\":\"-20CjufT\",\"post_great-firewall.md\":\"Mn8fZCkk\",\"post_apple.md\":\"GcssH-On\",\"post_infosec.md\":\"RrocYipq\",\"post_desk-setup.md\":\"_06WLp31\",\"post_message-queue.md\":\"4ZQYghlQ\",\"post_openwrt.md\":\"MQ8WJwQ-\",\"post_keyword-check.md\":\"n8mGNjw4\",\"post_java-stream.md\":\"BqT_KzKS\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"萨科的魔术盒\",\"description\":\"YangQuan的个人博客网站\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"author\":\"Yang Quan\",\"signature\":\"一个爱折腾的程序员 )=￣ω￣=)\",\"outline\":[2,6],\"nav\":[{\"title\":\"主页\",\"icon\":\"home\",\"link\":\"/\"},{\"title\":\"小游戏\",\"icon\":\"videogame_asset\",\"children\":[{\"title\":\"Chrome Dinosaur\",\"link\":\"/game/dinosaur/\",\"icon\":\"smart_toy\"},{\"title\":\"2048\",\"link\":\"/game/2048/\",\"icon\":\"casino\"}]}],\"socialLinks\":[{\"icon\":\"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8|0 0 16 16\",\"link\":\"https://github.com/YangQuan666\"},{\"icon\":\"M13.545 2.907a13.227 13.227 0 0 0-3.257-1.011.05.05 0 0 0-.052.025c-.141.25-.297.577-.406.833a12.19 12.19 0 0 0-3.658 0 8.258 8.258 0 0 0-.412-.833.051.051 0 0 0-.052-.025c-1.125.194-2.22.534-3.257 1.011a.041.041 0 0 0-.021.018C.356 6.024-.213 9.047.066 12.032c.001.014.01.028.021.037a13.276 13.276 0 0 0 3.995 2.02.05.05 0 0 0 .056-.019c.308-.42.582-.863.818-1.329a.05.05 0 0 0-.01-.059.051.051 0 0 0-.018-.011 8.875 8.875 0 0 1-1.248-.595.05.05 0 0 1-.02-.066.051.051 0 0 1 .015-.019c.084-.063.168-.129.248-.195a.05.05 0 0 1 .051-.007c2.619 1.196 5.454 1.196 8.041 0a.052.052 0 0 1 .053.007c.08.066.164.132.248.195a.051.051 0 0 1-.004.085 8.254 8.254 0 0 1-1.249.594.05.05 0 0 0-.03.03.052.052 0 0 0 .003.041c.24.465.515.909.817 1.329a.05.05 0 0 0 .056.019 13.235 13.235 0 0 0 4.001-2.02.049.049 0 0 0 .021-.037c.334-3.451-.559-6.449-2.366-9.106a.034.034 0 0 0-.02-.019Zm-8.198 7.307c-.789 0-1.438-.724-1.438-1.612 0-.889.637-1.613 1.438-1.613.807 0 1.45.73 1.438 1.613 0 .888-.637 1.612-1.438 1.612m5.316 0c-.788 0-1.438-.724-1.438-1.612 0-.889.637-1.613 1.438-1.613.807 0 1.451.73 1.438 1.613 0 .888-.631 1.612-1.438 1.612|0 0 16 16\",\"link\":\"https://discord.gg/J8BVvnsWeB\"}],\"sponsor\":{\"icon\":\"M2.541 0H13.5a2.551 2.551 0 0 1 2.54 2.563v8.297c-.006 0-.531-.046-2.978-.813-.412-.14-.916-.327-1.479-.536-.303-.113-.624-.232-.957-.353a12.98 12.98 0 0 0 1.325-3.373H8.822V4.649h3.831v-.634h-3.83V2.121H7.26c-.274 0-.274.273-.274.273v1.621H3.11v.634h3.875v1.136h-3.2v.634H9.99c-.227.789-.532 1.53-.894 2.202-2.013-.67-4.161-1.212-5.51-.878-.864.214-1.42.597-1.746.998-1.499 1.84-.424 4.633 2.741 4.633 1.872 0 3.675-1.053 5.072-2.787 2.08 1.008 6.37 2.738 6.387 2.745v.105A2.551 2.551 0 0 1 13.5 16H2.541A2.552 2.552 0 0 1 0 13.437V2.563A2.552 2.552 0 0 1 2.541 0M2.309 9.27c-1.22 1.073-.49 3.034 1.978 3.034 1.434 0 2.868-.925 3.994-2.406-1.602-.789-2.959-1.353-4.425-1.207-.397.04-1.14.217-1.547.58Z|0 0 16 16\",\"link\":\"https://qr.alipay.com/fkx12630qiigpvf7yb0nd85\"},\"comment\":{\"icon\":\"question_answer\",\"link\":\"https://github.com/YangQuan666/yangquan666.github.io/discussions\"},\"footer\":{\"message\":\"Released under the GPL License.\",\"releaseNote\":\"https://github.com/YangQuan666/yangquan666.github.io/blob/main/CHANGELOG.md\",\"version\":\"0.1.0\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>